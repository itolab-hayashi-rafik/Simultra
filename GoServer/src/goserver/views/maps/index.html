<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <title>Simultra</title>
    <link rel="stylesheet" href="/stylesheets/maps/main.css">
    {{if .mono}}
    <link rel="stylesheet" href="/vendor/vizicities-mono.css">
    {{else}}
    <link rel="stylesheet" href="/vendor/vizicities.css">
    {{end}}
    <link rel="stylesheet" href="/vendor/simultra.css">
</head>
<body>
<div id="world"></div>
<script src="/vendor/three.min.js"></script>
<script src="/vendor/stats.min.js"></script>
<script src="/vendor/threex.rendererstats.js"></script>
<script src="/vendor/TweenMax.min.js"></script>
<script src="/vendor/operative.min.js"></script>
{{if .mono}}
<script src="/vendor/vizicities-mono.min.js"></script>
{{else}}
<script src="/vendor/vizicities.min.js"></script>
{{end}}
<script src="/vendor/jquery-3.0.0.min.js"></script>
<script src="/vendor/simultra.js"></script>
<script type="text/javascript">
    // FIXME: something is wrong with the Simultra compilation. it's not UMD...
    window.Simultra = window.Simultra.default;

    if (typeof Simultra === 'function') {
        simultra = new Simultra(location.protocol + '//' + location.host, null, {
            debug: {{.debug}},
            renderer: "{{.renderer}}"
        });
        {{if .dynamic}}
        simultra.start();
        {{end}}

        {{if .test}}
        <!-- beginning of test -->
        // remove building layer
        simultra._buildingLayer.remove();

        // add cars
        var veyrons = [];
        for (var i = 0; i < {{.n}}; i++) {
            veyrons.push(
                    simultra._vehicleLayer._addVehicle({
                        type: 'veyron',
                        location: {lat: 35.156324 + (0.0003*~~(i/{{.sn}})), lon: 136.923108 + 0.0003*(i%{{.sn}})},
                        velocity: 40 / 3600 * 1000,
                        angle: 0.0,
                        wheel: 30*Math.PI/180.0
                    })
            );
        }

        // sets the vehicles to move
        simultra._vehicleLayer._viziLayer.on('loadCompleted', function() {
            veyrons.forEach(function(veyron, id) {
                simultra._vehicleLayer._viziLayer.setVelocity(id, veyron.data.velocity, 0, 0, veyron.data.wheel);
            });
        });
        <!-- end of test -->
        {{end}}
    }
</script>
</body>
</html>