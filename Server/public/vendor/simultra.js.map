{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 7c7af0cbd9dd064c7f84","webpack:///./src/simultra.js","webpack:///external \"VIZI\"","webpack:///./~/eventemitter3/index.js","webpack:///./~/extend/index.js","webpack:///external \"Stats\"","webpack:///external \"THREEx\"","webpack:///./src/layer/BasemapLayer.js","webpack:///./src/layer/Layer.js","webpack:///./src/util/index.js","webpack:///./src/util/BuildingUtils.js","webpack:///./src/util/FootwayUtils.js","webpack:///./src/util/HighwayUtils.js","webpack:///./src/util/WorkerUtils.js","webpack:///./src/layer/BuildingLayer.js","webpack:///./src/layer/FootwayLayer.js","webpack:///./src/layer/HighwayLayer.js","webpack:///./src/layer/PedestrianLayer.js","webpack:///./src/io/API.js","webpack:///./src/io/WebClient.js","webpack:///./src/layer/VehicleLayer.js","webpack:///external \"operative\""],"names":["Simultra","baseUrl","defaultCoords","options","defaultOptions","debug","renderer","renderBasemap","renderHighway","renderFootway","renderBuilding","renderVehicle","renderPedestrian","fixCamera","_options","_api","_isRunning","_focusedObject","coords","_setupWorld","_setupLayers","_setupEvents","_setupDebug","self","world","skybox","postProcessing","setView","_environment","_skybox","setInclination","camera","getCamera","position","set","control","Controls","orbit","addTo","_control","on","delta","_onWorldUpdate","_world","_basemapLayer","_highwayLayer","_footwayLayer","_buildingLayer","_vehicleLayer","_pedestrianLayer","id","entry","emit","sender","stats","dom","style","top","zIndex","document","body","appendChild","_stats","RendererStats","rendererStats","domElement","left","bottom","_rendererStats","update","_engine","_renderer","_updateCameraPosition","latLon","point","latLonToPoint","lookAtPoint","target","_controls","moveTarget","THREE","Vector3","x","y","copy","moveToPoint","offset","sub","add","time","zoom","flyToLatLon","flyToPoint","start","stop","map","type","scenario","startSimulation","isRunning","stopSimulation","object","lookAtLatLon","moveToLatLon","Error","vid","focusOn","pid","window","BasemapLayer","_setup","viziLayer","imageTileLayer","attribution","_setViziLayer","Layer","_viziLayer","_simultra","simultra","undefined","_onAdd","removeLayer","_onRemove","Util","BuildingUtils","FootwayUtils","HighwayUtils","WorkerUtils","feature","defaultValue","height","properties","Math","random","defaultValues","geometry","color","transparent","opacity","lineColor","lineWidth","lineTransparent","lineOpacity","lineBlending","AdditiveBlending","lineRenderOrder","pointWidth","pointHeight","pointColor","HIGHWAY_COLOR_MAP","KIND_COLOR_MAP","HIGHWAY_WIDTH_MAP","highway","console","info","kind","width","lineStringToPolygon","multiLineStringToPolygon","coordss","cLatLon","pLatLon","nLatLon","cGeoCoord","pGeoCoord","nGeoCoord","vVert","Point","_vVert","vMean","vPadding","_vPadding","p","_p","outCoordss","forEach","outCoords","i","length","LatLon","normalize","pointToLatLon","splice","lon","lat","idx","push","l","sqrt","pow","base","current","currentScript","src","scripts","getElementsByTagName","script","dirname","dependencies","getDependencies","basename","path","replace","BuildingLayer","topoJSONTileLayer","interactive","maxLOD","filter","FootwayLayer","lanes","log","HighwayLayer","_getViziWorld","coordinates","UPDATE_INTERVAL_MS","PedestrianLayer","_pedestrians","pedestrianLayer","file","scale","translation","z","rotation","enableGpuComputation","simWidth","_worker","operative","_createWorker","_createWorkerCallback","ws","wsPedestrians","onclose","event","onmessage","_onMessage","data","onopen","_ws","setTimeout","_update","close","error","_lastUpdatedAt","Date","now","getPedestrians","then","_performUpdate","catch","err","_getViziLayer","_hasPedestrian","pedestrian","_addPedestrian","addPedestrian","location","angle","JSON","stringify","_baseUrl","_callback","callback","SimWorker","API","_interval","socket","wsAllPedestrians","parse","that","scopes","defaultScope","prevSender","msg","scope","setLabelClass","setLabelText","setLocation","setVelocity","velocity","_getSimultra","_vehicles","vehicle","root","START_SIMULATION","IS_RUNNING","STOP_SIMULATION","GET_VEHICLES","UPDATE_VEHICLES","GET_VEHICLE","WS_VEHICLES","WS_VEHICLE","GET_PEDESTRIANS","UPDATE_PEDESTRIANS","GET_PEDESTRIAN","WS_PEDESTRIANS","WS_PEDESTRIAN","wsBaseUrl","_ajax","url","method","WebSocket","wsVehicle","wsPedestrian","WebClient","param","defaultParam","Promise","resolve","reject","toUpperCase","xhr","XMLHttpRequest","open","responseType","onload","status","response","statusText","onerror","send","VehicleLayer","vehicleLayer","wheel","textureFile","PI","wsVehicles","getVehicles","_hasVehicle","_addVehicle","addVehicle","_socket","wsAllVehicles"],"mappings":"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AO;AAClB,YAAW,QAAQ;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,2DAA0D,OAAO;AACjE;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0CAAyC,SAAS;AAClD;AACA;;AAEA;AACA,IAAG;AACH;AACA;;AAEA,gBAAe,YAAY;AAC3B;;AAEA;AACA,4DAA2D;AAC3D,gEAA+D;AAC/D,oEAAmE;AACnE;AACA,2DAA0D,SAAS;AACnE;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,SAAS;AACpB,YAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;;AAEA,gDAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,SAAS;AACpB,YAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;;AAEA,gDAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,SAAS;AACpB,YAAW,MAAM;AACjB,YAAW,QAAQ;AACnB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,iDAAgD,YAAY;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA,kCAAiC;;AAEjC;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAC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","file":"simultra.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"VIZI\"), require(\"Stats\"), require(\"THREEx\"), require(\"operative\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"VIZI\", \"Stats\", \"THREEx\", \"operative\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Simultra\"] = factory(require(\"VIZI\"), require(\"Stats\"), require(\"THREEx\"), require(\"operative\"));\n\telse\n\t\troot[\"Simultra\"] = factory(root[\"VIZI\"], root[\"Stats\"], root[\"THREEx\"], root[\"operative\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_20__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 7c7af0cbd9dd064c7f84\n **/","import VIZI from 'vizi';\nimport EventEmitter from 'eventemitter3';\nimport extend from 'extend';\nimport Stats from 'stats';\nimport THREEx from 'threex';\n\nimport BasemapLayer from './layer/BasemapLayer';\nimport BuildingLayer from './layer/BuildingLayer';\nimport FootwayLayer from './layer/FootwayLayer';\nimport HighwayLayer from './layer/HighwayLayer';\nimport PedestrianLayer from './layer/PedestrianLayer';\nimport VehicleLayer from './layer/VehicleLayer';\n\nimport API from './io/API';\nimport Util from './util/index';\n\nclass Simultra extends EventEmitter {\n  constructor(baseUrl, defaultCoords, options) {\n    super();\n\n    var defaultOptions = {\n      debug: true,\n      renderer: 'cpu',\n      renderBasemap: true,\n      renderHighway: true,\n      renderFootway: true,\n      renderBuilding: true,\n      renderVehicle: true,\n      renderPedestrian: true,\n      fixCamera: false,\n    };\n    this._options = extend({}, defaultOptions, options);\n\n    this._api = new API(baseUrl);\n    this._isRunning = false;\n\n    this._focusedObject = null;\n\n    var coords = defaultCoords || [35.156324, 136.923108];\n\n    this._setupWorld(coords);\n    this._setupLayers();\n    this._setupEvents();\n    this._setupDebug();\n  }\n\n  _setupWorld(coords) {\n    var self = this;\n\n    // create a world\n    var world = VIZI.world('world', {\n      skybox: true,\n      postProcessing: false\n    }).setView(coords);\n    world._environment._skybox.setInclination(0.1);\n\n    // obtain the camera\n    var camera = world.getCamera();\n    camera.position.set(-150, 175, 125);\n\n    // Add controls\n    var control = VIZI.Controls.orbit().addTo(world);\n    this._control = control;\n\n    // add callbacks\n    world.on('preUpdate', function(delta) {\n      self._onWorldUpdate(delta);\n    });\n\n    // set the instance properties\n    this._world = world;\n  }\n\n  _setupLayers() {\n    // Basemap\n    this._basemapLayer    = this._options.renderBasemap    ? new BasemapLayer(this._options).addTo(this)    : null;\n    // Highway\n    this._highwayLayer    = this._options.renderHighway    ? new HighwayLayer(this._options).addTo(this)    : null;\n    // Footway\n    this._footwayLayer    = this._options.renderFootway    ? new FootwayLayer(this._options).addTo(this)    : null;\n    // Building\n    this._buildingLayer   = this._options.renderBuilding   ? new BuildingLayer(this._options).addTo(this)   : null;\n    // Vehicle\n    this._vehicleLayer    = this._options.renderVehicle    ? new VehicleLayer(this._options).addTo(this)    : null;\n    // Pedestrian\n    this._pedestrianLayer = this._options.renderPedestrian ? new PedestrianLayer(this._options).addTo(this) : null;\n  }\n\n  _setupEvents() {\n    var self = this;\n\n    // Vehicle\n    if (this._vehicleLayer) {\n      this._vehicleLayer.on('onAddVehicle', function(id, entry) { self.emit('onAddVehicle', id, entry); });\n      this._vehicleLayer.on('onUpdateVehicle', function(id, entry, sender) { self.emit('onUpdateVehicle', id, entry, sender); });\n    }\n    // Pedestrian\n    if (this._pedestrianLayer) {\n      this._pedestrianLayer.on('onAddPedestrian', function(id, entry) { self.emit('onAddPedestrian', id, entry); });\n      this._pedestrianLayer.on('onUpdatePedestrian', function(id, entry, sender) { self.emit('onUpdatePedestrian', id, entry, sender); });\n    }\n  }\n\n  _setupDebug() {\n    if (this._options.debug) {\n      // Stats\n      if (typeof Stats === 'function') {\n        var stats = new Stats();\n        stats.dom.style.position = 'absolute';\n        stats.dom.style.top = '0px';\n        stats.dom.style.zIndex = 100;\n        document.body.appendChild(stats.dom);\n        this._stats = stats;\n      }\n\n      // THREEx.RendererStats\n      if (typeof THREEx.RendererStats === 'function') {\n        var rendererStats = new THREEx.RendererStats();\n        rendererStats.domElement.style.position = 'absolute';\n        rendererStats.domElement.style.left = '0px';\n        rendererStats.domElement.style.bottom   = '0px';\n        document.body.appendChild(rendererStats.domElement);\n        this._rendererStats = rendererStats;\n      }\n    }\n  }\n\n  _onWorldUpdate(delta) {\n    // for debugging\n    if (this._options.debug) {\n      // Stats\n      if (this._stats) {\n        this._stats.update();\n      }\n\n      // RenderStats\n      if (this._rendererStats) {\n        this._rendererStats.update(this._world._engine._renderer);\n      }\n    }\n\n    // focus\n    this._updateCameraPosition();\n  }\n\n  lookAtLatLon(latLon) {\n    var point = this._world.latLonToPoint(latLon);\n    this.lookAtPoint(point);\n  }\n\n  lookAtPoint(point) {\n    // camera.lookAt(moveTarget); // TODO: this does not work. OrbitControl.js overrides this function!!\n\n    // camera ref\n    var camera = this._world.getCamera();\n    var target = this._control._controls.target;\n\n    // target to move to\n    var moveTarget = new THREE.Vector3(point.x, 0, point.y);\n\n    // apply!\n    target.copy(moveTarget);\n  }\n\n  moveToLatLon(latLon) {\n    var point = this._world.latLonToPoint(latLon);\n    this.moveToPoint(point);\n  }\n\n  moveToPoint(point) {\n    // camera ref\n    var camera = this._world.getCamera();\n    var target = this._control._controls.target;\n\n    // camera offset\n    var offset = new THREE.Vector3();\n    offset.copy(camera.position).sub(target);\n\n    // target to move to\n    var moveTarget = new THREE.Vector3(point.x, 0, point.y);\n\n    // apply!\n    target.copy(moveTarget);\n    camera.position.copy(target).add(offset);\n  }\n\n  /**\n   * Sets the center coordinate of the view\n   * @param lat latitude\n   * @param lon longitude\n   */\n  flyToLatLon(latLon, time, zoom) {\n    this._control.flyToLatLon(latLon, time, zoom);\n  }\n\n  /**\n   * Flyies to the point\n   * @param point\n   */\n  flyToPoint(point, time, zoom) {\n    this._control.flyToPoint(point, time, zoom);\n  }\n\n  /**\n   * Starts updating the view\n   */\n  start() {\n    this._vehicleLayer    && this._vehicleLayer.start();\n    this._pedestrianLayer && this._pedestrianLayer.start();\n    this._isRunning = true;\n  }\n\n  /**\n   * Stops updating the view\n   */\n  stop() {\n    this._vehicleLayer    && this._vehicleLayer.stop();\n    this._pedestrianLayer && this._pedestrianLayer.stop();\n    this._isRunning = false;\n  }\n\n  /**\n   * Returns if the view updating loop is running\n   *\n   * @returns {boolean}\n   */\n  isRunning() {\n    return this._isRunning;\n  }\n\n  /**\n   * Controls the remote to start the simulation\n   *\n   * @param map\n   * @param type\n   * @param scenario\n   */\n  startSimulation(map, type, scenario) {\n    return this._api.startSimulation(map, type, scenario);\n  }\n\n  /**\n   * Returns if the simulation is running\n   * @returns {*}\n   */\n  isSimulationRunning() {\n    return this._api.isRunning();\n  }\n\n  /**\n   * Controls the remote to stop the simulation\n   */\n  stopSimulation() {\n    return this._api.stopSimulation();\n  }\n\n  /**\n   * Updates the camera position to follow the vehicles\n   *\n   * @private\n   */\n  _updateCameraPosition() {\n    if (this._focusedObject != null) {\n      var object = this._focusedObject;\n      var latLon = !('latLon' in object) ? null : (typeof object.latLon === 'function') ? object.latLon() : object.latLon;\n      var point = !('point' in object) ? null : (typeof object.point === 'function') ? object.point() : object.point;\n\n      if (latLon != null) {\n        this._options.fixCamera ? this.lookAtLatLon(latLon) : this.moveToLatLon(latLon);\n      } else if (point != null) {\n        this._options.fixCamera ? this.lookAtPoint(point) : this.moveToPoint(point);\n      }\n    }\n  }\n\n  /**\n   * Focuses on an object\n   *\n   * @param object an object that has either a function or property named \"latLon\" that returns VIZI.LatLon location or \"point\" that returns VIZI.point position\n   */\n  focusOn(object) {\n    if (object != null && !('latLon' in object) && !('point' in object)) {\n      throw new Error('object needs to have a property or function named \"latLon\" that returns VIZI.LatLon location or \"point\" that returns VIZI.Point position');\n    }\n    this._focusedObject = object;\n  }\n\n  /**\n   * Focuses on a vehicle\n   *\n   * @param vid\n   */\n  focusOnVehicle(vid) {\n    // proxy VehicleLayer#focusOn()\n    this._vehicleLayer && this._vehicleLayer.focusOn(vid);\n  }\n\n  /**\n   * Focuses on a pedestrian\n   *\n   * @param pid\n   */\n  focusOnPedestrian(pid) {\n    // proxy PedestrianLayer#focusOn()\n    this._pedestrianLayer && this._pedestrianLayer.focusOn(pid);\n  }\n}\n\nexport default Simultra;\nwindow.Simultra = Simultra;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/simultra.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"VIZI\"\n ** module id = 1\n ** module chunks = 0\n **/","'use strict';\n\nvar has = Object.prototype.hasOwnProperty;\n\n//\n// We store our EE objects in a plain object whose properties are event names.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// `~` to make sure that the built-in object properties are not overridden or\n// used as an attack vector.\n// We also assume that `Object.create(null)` is available when the event name\n// is an ES6 Symbol.\n//\nvar prefix = typeof Object.create !== 'function' ? '~' : false;\n\n/**\n * Representation of a single EventEmitter function.\n *\n * @param {Function} fn Event handler to be called.\n * @param {Mixed} context Context for function execution.\n * @param {Boolean} [once=false] Only emit once\n * @api private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Minimal EventEmitter interface that is molded against the Node.js\n * EventEmitter interface.\n *\n * @constructor\n * @api public\n */\nfunction EventEmitter() { /* Nothing to set */ }\n\n/**\n * Hold the assigned EventEmitters by name.\n *\n * @type {Object}\n * @private\n */\nEventEmitter.prototype._events = undefined;\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @api public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var events = this._events\n    , names = []\n    , name;\n\n  if (!events) return names;\n\n  for (name in events) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return a list of assigned event listeners.\n *\n * @param {String} event The events that should be listed.\n * @param {Boolean} exists We only need to know if there are listeners.\n * @returns {Array|Boolean}\n * @api public\n */\nEventEmitter.prototype.listeners = function listeners(event, exists) {\n  var evt = prefix ? prefix + event : event\n    , available = this._events && this._events[evt];\n\n  if (exists) return !!available;\n  if (!available) return [];\n  if (available.fn) return [available.fn];\n\n  for (var i = 0, l = available.length, ee = new Array(l); i < l; i++) {\n    ee[i] = available[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Emit an event to all registered event listeners.\n *\n * @param {String} event The name of the event.\n * @returns {Boolean} Indication if we've emitted an event.\n * @api public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events || !this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if ('function' === typeof listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Register a new EventListener for the given event.\n *\n * @param {String} event Name of the event.\n * @param {Function} fn Callback function.\n * @param {Mixed} [context=this] The context of the function.\n * @api public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  var listener = new EE(fn, context || this)\n    , evt = prefix ? prefix + event : event;\n\n  if (!this._events) this._events = prefix ? {} : Object.create(null);\n  if (!this._events[evt]) this._events[evt] = listener;\n  else {\n    if (!this._events[evt].fn) this._events[evt].push(listener);\n    else this._events[evt] = [\n      this._events[evt], listener\n    ];\n  }\n\n  return this;\n};\n\n/**\n * Add an EventListener that's only called once.\n *\n * @param {String} event Name of the event.\n * @param {Function} fn Callback function.\n * @param {Mixed} [context=this] The context of the function.\n * @api public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  var listener = new EE(fn, context || this, true)\n    , evt = prefix ? prefix + event : event;\n\n  if (!this._events) this._events = prefix ? {} : Object.create(null);\n  if (!this._events[evt]) this._events[evt] = listener;\n  else {\n    if (!this._events[evt].fn) this._events[evt].push(listener);\n    else this._events[evt] = [\n      this._events[evt], listener\n    ];\n  }\n\n  return this;\n};\n\n/**\n * Remove event listeners.\n *\n * @param {String} event The event we want to remove.\n * @param {Function} fn The listener that we need to find.\n * @param {Mixed} context Only remove listeners matching this context.\n * @param {Boolean} once Only remove once listeners.\n * @api public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events || !this._events[evt]) return this;\n\n  var listeners = this._events[evt]\n    , events = [];\n\n  if (fn) {\n    if (listeners.fn) {\n      if (\n           listeners.fn !== fn\n        || (once && !listeners.once)\n        || (context && listeners.context !== context)\n      ) {\n        events.push(listeners);\n      }\n    } else {\n      for (var i = 0, length = listeners.length; i < length; i++) {\n        if (\n             listeners[i].fn !== fn\n          || (once && !listeners[i].once)\n          || (context && listeners[i].context !== context)\n        ) {\n          events.push(listeners[i]);\n        }\n      }\n    }\n  }\n\n  //\n  // Reset the array, or remove it completely if we have no more listeners.\n  //\n  if (events.length) {\n    this._events[evt] = events.length === 1 ? events[0] : events;\n  } else {\n    delete this._events[evt];\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners or only the listeners for the specified event.\n *\n * @param {String} event The event want to remove all listeners for.\n * @api public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  if (!this._events) return this;\n\n  if (event) delete this._events[prefix ? prefix + event : event];\n  else this._events = prefix ? {} : Object.create(null);\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// This function doesn't apply anymore.\n//\nEventEmitter.prototype.setMaxListeners = function setMaxListeners() {\n  return this;\n};\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/eventemitter3/index.js\n ** module id = 2\n ** module chunks = 0\n **/","'use strict';\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\n\nvar isArray = function isArray(arr) {\n\tif (typeof Array.isArray === 'function') {\n\t\treturn Array.isArray(arr);\n\t}\n\n\treturn toStr.call(arr) === '[object Array]';\n};\n\nvar isPlainObject = function isPlainObject(obj) {\n\tif (!obj || toStr.call(obj) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tvar hasOwnConstructor = hasOwn.call(obj, 'constructor');\n\tvar hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) {/**/}\n\n\treturn typeof key === 'undefined' || hasOwn.call(obj, key);\n};\n\nmodule.exports = function extend() {\n\tvar options, name, src, copy, copyIsArray, clone,\n\t\ttarget = arguments[0],\n\t\ti = 1,\n\t\tlength = arguments.length,\n\t\tdeep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === 'boolean') {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t} else if ((typeof target !== 'object' && typeof target !== 'function') || target == null) {\n\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\toptions = arguments[i];\n\t\t// Only deal with non-null/undefined values\n\t\tif (options != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = target[name];\n\t\t\t\tcopy = options[name];\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target !== copy) {\n\t\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\t\ttarget[name] = extend(deep, clone, copy);\n\n\t\t\t\t\t// Don't bring in undefined values\n\t\t\t\t\t} else if (typeof copy !== 'undefined') {\n\t\t\t\t\t\ttarget[name] = copy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/extend/index.js\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"Stats\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_5__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"THREEx\"\n ** module id = 5\n ** module chunks = 0\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\n\nimport Util from '../util/index';\n\nclass BasemapLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {};\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._setup();\n  }\n\n  _setup() {\n    // CartoDB basemap\n    var viziLayer = VIZI.imageTileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>'\n    });\n\n    this._setViziLayer(viziLayer);\n  }\n}\n\nexport default BasemapLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/BasemapLayer.js\n **/","import VIZI from 'vizi';\nimport EventEmitter from 'eventemitter3';\n\n/**\n * Base Layer class\n */\nclass Layer extends EventEmitter {\n  constructor(options) {\n    super();\n\n    // delegate layer\n    this._viziLayer = null;\n    this._options = options;\n\n    this._simultra = null;\n    this._api = null;\n  }\n\n  _setViziLayer(viziLayer) {\n    this._viziLayer = viziLayer;\n  }\n\n  _getViziLayer() {\n    return this._viziLayer;\n  }\n\n  _getViziWorld() {\n    return this._simultra._world;\n  }\n\n  _getSimultra() {\n    return this._simultra;\n  }\n\n  addTo(simultra) {\n    if (this._viziLayer === undefined) {\n      throw new Error('Layer not initialized');\n    }\n    if (simultra._world === undefined) {\n      throw new Error('Simultra not initialized');\n    }\n\n    this._simultra = simultra;\n    this._onAdd(simultra);\n\n    this._viziLayer.addTo(simultra._world);\n\n    return this;\n  }\n\n  _onAdd(simultra) {\n    this._api = simultra._api;\n  }\n\n  remove() {\n    if (this._viziLayer && this._simultra._world) {\n      this._simultra._world.removeLayer(this._viziLayer);\n    }\n\n    this._simultra = null;\n    this._onRemove();\n\n    return this;\n  }\n\n  _onRemove() {\n    // do something when this layer is removed from simultra\n  }\n}\n\nexport default Layer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/Layer.js\n **/","/**\n * Utility\n */\nimport BuildingUtils from './BuildingUtils';\nimport FootwayUtils from './FootwayUtils';\nimport HighwayUtils from './HighwayUtils';\nimport WorkerUtils from './WorkerUtils';\n\nconst Util = {};\n\nUtil.BuildingUtils = BuildingUtils;\nUtil.FootwayUtils = FootwayUtils;\nUtil.HighwayUtils = HighwayUtils;\nUtil.WorkerUtils = WorkerUtils;\n\nexport default Util;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/index.js\n **/","/**\n * Building Utilities\n */\nimport VIZI from 'vizi';\nimport extend from 'extend';\n\nvar BuildingUtils = (function() {\n\n  /**\n   * Return the style for a specific building\n   *\n   * @param {Object} feature\n   * @param {Object} defaultValue\n   */\n  var style = function(feature, defaultValue) {\n    var height;\n\n    if (feature.properties.height) {\n      height = feature.properties.height;\n    } else {\n      height = 10 + Math.random() * 10;\n    }\n\n    // construct the style\n    var style = {\n      height: height || defaultValue.height\n    };\n\n    return extend({}, defaultValue, style);\n  };\n\n  // return the utility object\n  return {\n    style: style\n  };\n})();\n\nexport default BuildingUtils;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/BuildingUtils.js\n **/","/**\n * Footway Utilities\n */\nimport VIZI from 'vizi';\nimport extend from 'extend';\n\nvar FootwayUtils = (function() {\n\n  /**\n   * Return the style for a specific footway\n   *\n   * @param {Object} feature\n   * @param {Object} defaultValues\n   */\n  var style = function(feature, defaultValues) {\n    var style;\n\n    // Polygon\n    if (feature.geometry.type === 'Polygon') {\n      style = {\n        color: '#ecebe9',\n        transparent: true,\n        opacity: 0.2\n      };\n    }\n    // Line\n    else if (feature.geometry.type === 'LineString') {\n      style = {\n        lineColor: '#cad9d4',\n        lineWidth: 1,\n        lineTransparent: true,\n        lineOpacity: 0.2,\n        lineBlending: THREE.AdditiveBlending,\n        lineRenderOrder: 2\n      };\n    }\n    // Point\n    else {\n      style = {\n        pointWidth: 1.0,\n        pointHeight: 1.0,\n        pointColor: '#0000ff'\n      };\n    }\n\n    return extend({}, defaultValues, style);\n  };\n\n  // return utility object\n  return {\n    style: style\n  };\n})();\n\nexport default FootwayUtils;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/FootwayUtils.js\n **/","/**\n * Highway Utilities\n */\nimport VIZI from 'vizi';\nimport extend from 'extend';\n\n// --- constants\n// jscs:disable disallowSpaceAfterObjectKeys\nconst HIGHWAY_COLOR_MAP = {\n  'motorway'      : '#9e250e', // express way\n  'major'         : '#f7c616', // main road\n  'primary'       : '#ffe104', // national highway\n  'secondary'     : '#ffffff', // sub road\n  'tertiary'      : '#ffffff', // sub road\n  'residental'    : '#ffffff', // minor road\n  'living_street' : '#ffffff', // minor road\n  'track'         : '#ffffff', // ?\n  'trunk'         : '#ffffff', // ?\n  'footway'       : '#ffffff', // footway\n  'pedestrian'    : '#f0ebeb', // pedestrian\n};\nconst KIND_COLOR_MAP = {\n  'major_road': '#f7c616',\n  'minor_road': '#ffffff',\n  'highway'   : '#888785',\n  'path'      : '#888785',\n  'rail'      : '#888785',\n};\nconst HIGHWAY_WIDTH_MAP = {\n  'motorway'      : 10, // express way\n  'major'         : 10, // main road\n  'primary'       : 10, // national highway\n  'secondary'     : 7,  // sub road\n  'tertiary'      : 6,  // sub road\n  'residental'    : 5,  // minor road\n  'living_street' : 4,  // minor road\n  'track'         : 3,  // ?\n  'trunk'         : 3,  // ?\n  'footway'       : 1,  // footway\n  'pedestrian'    : 1,  // pedestrian\n};\n// jscs:enable disallowSpaceAfterObjectKeys\n// ---\n\nvar HighwayUtils = (function() {\n\n  /**\n   * Return the style for a specific highway\n   *\n   * @param {Object} feature\n   */\n  var style = function(feature, defaultValue) {\n    var color;\n\n    // ---- color\n    // based on 'highway' property\n    if (feature.properties.highway) {\n      if (feature.properties.highway in HIGHWAY_COLOR_MAP) {\n        color = HIGHWAY_COLOR_MAP[feature.properties.highway];\n      } else {\n        // unknown highway\n        console.info('Unknown highway: ' + feature.properties.highway);\n      }\n    }\n    // based on 'kind' property\n    else if (feature.properties.kind) {\n      if (feature.properties.kind in KIND_COLOR_MAP) {\n        color = KIND_COLOR_MAP[feature.properties.kind];\n      } else {\n        // unknown highway kind\n        console.info('Unknown highway kind: ' + feature.properties.kind);\n      }\n    }\n    // ---\n\n    // construct the style\n    var style = {\n      color: color || defaultValue.color\n    };\n\n    return extend({}, defaultValue, style);\n  };\n\n  /**\n   * Return the line width for a specific highway\n   *\n   * @param {Object} feature\n   */\n  var lineWidth = function(feature, defaultValue) {\n    var lineWidth;\n    // look for the line weight in the property\n    if (feature.properties.width) {\n      lineWidth = feature.properties.width;\n    }\n    // guess lineWidth from the highway type\n    else if (feature.properties.highway) {\n      if (feature.properties.highway in HIGHWAY_WIDTH_MAP) {\n        lineWidth = HIGHWAY_WIDTH_MAP[feature.properties.highway];\n      } else {\n        // unknown highway type\n        console.info('Unknown highway: ' + feature.properties.highway);\n        lineWidth = defaultValue;\n      }\n    }\n    // no way to find out the width\n    else {\n      // no highway type mentioned\n      lineWidth = defaultValue;\n    }\n    return lineWidth;\n  };\n\n  /**\n   * Convert LineString to Polygon\n   *\n   * @param {Object} world VIZI.World object\n   * @param {Array} coords LineString, e.g. [[lon, lat], [lon, lat], ...]\n   * @param {Number} lineWidth the width of the lines\n   */\n  var lineStringToPolygon = function(world, coords, lineWidth) {\n    return multiLineStringToPolygon(world, [coords], lineWidth);\n  };\n\n  /**\n   * Convert MultiLineString to Polygon\n   *\n   * @param {Object} world VIZI.World object\n   * @param {Array} coordss Array of LineStrings, e.g. [[[lon, lat], [lon, lat], ...], ...]\n   * @param {Number} lineWidth the width of the lines\n   * @returns {Array}\n   */\n  var multiLineStringToPolygon = function(world, coordss, lineWidth) {\n    if (lineWidth === undefined) {\n      lineWidth = 1.0;\n    }\n\n    // jscs:disable disallowMultipleVarDecl\n    var cLatLon, pLatLon, nLatLon;\n    var cGeoCoord, pGeoCoord, nGeoCoord;\n    var vVert = new VIZI.Point(), _vVert   = new VIZI.Point();\n    var vMean = new VIZI.Point(), vPadding = new VIZI.Point(), _vPadding = new VIZI.Point();\n    var p = new VIZI.Point(), _p;\n    // jscs:enable disallowMultipleVarDecl\n\n    var outCoordss = [];\n\n    coordss.forEach(function(coords) {\n      var outCoords = [];\n\n      cLatLon = pLatLon = nLatLon = null;\n      cGeoCoord = pGeoCoord = nGeoCoord = null;\n\n      for (var i = 0; i < coords.length; i++) {\n        cLatLon   = nLatLon   || new VIZI.LatLon(coords[i][1], coords[i][0]);\n        cGeoCoord = nGeoCoord || world.latLonToPoint(cLatLon);\n\n        // project the next coordinate\n        if (i < coords.length - 1) {\n          nLatLon = new VIZI.LatLon(coords[i + 1][1], coords[i + 1][0]);\n          nGeoCoord = world.latLonToPoint(nLatLon);\n\n          // calculate the vertical vector\n          vVert.x = -(nGeoCoord.y - cGeoCoord.y);\n          vVert.y =  (nGeoCoord.x - cGeoCoord.x);\n          normalize(vVert);\n\n          // incorpolate the vertical vector with the previous one\n          if (i == 0) {\n            _vVert.x = vVert.x; _vVert.y = vVert.y;\n          }\n          vMean.x = (vVert.x + _vVert.x) / 2.0; vMean.y = (vVert.y + _vVert.y) / 2.0;\n          normalize(vMean);\n          vPadding.x =  vMean.x * lineWidth; vPadding.y =  vMean.y * lineWidth;\n        } else {\n          vPadding.x = _vVert.x * lineWidth; vPadding.y = _vVert.y * lineWidth;\n        }\n\n        // construct polygons\n        if (0 < i) {\n          if (i == 1) {\n            // left top\n            p.x = pGeoCoord.x - _vPadding.x; p.y = pGeoCoord.y - _vPadding.y;\n            _p = world.pointToLatLon(p);\n            outCoords.splice(0, 0, [_p.lon, _p.lat]);\n\n            // left bottom\n            p.x = pGeoCoord.x + _vPadding.x; p.y = pGeoCoord.y + _vPadding.y;\n            _p = world.pointToLatLon(p);\n            outCoords.splice(0, 0, [_p.lon, _p.lat]);\n          }\n\n          var idx = outCoords.length / 2;\n          // right bottom\n          p.x = cGeoCoord.x + vPadding.x; p.y = cGeoCoord.y + vPadding.y;\n          _p = world.pointToLatLon(p);\n          outCoords.splice(idx, 0, [_p.lon, _p.lat]);\n\n          // right top\n          p.x = cGeoCoord.x - vPadding.x; p.y = cGeoCoord.y - vPadding.y;\n          _p = world.pointToLatLon(p);\n          outCoords.splice(idx + 1, 0, [_p.lon, _p.lat]);\n        }\n\n        // keep the vectors as the previous one\n        pLatLon = cLatLon;\n        pGeoCoord = cGeoCoord;\n        _vVert.x = vVert.x; _vVert.y = vVert.y;\n        _vPadding.x = vPadding.x; _vPadding.y = vPadding.y;\n      }\n\n      // add the first vertice at the end to make the polygon closed\n      outCoords.push(outCoords[0]);\n\n      // add this polygon to the array of polygons\n      outCoordss.push([outCoords]);\n    });\n\n    return outCoordss;\n  };\n\n  // --- internal helper methods\n  /** Normalize VIZI.Point */\n  function normalize(p) {\n    var l = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    l = (l === 0.0) ? 1.0 : l;\n    p.x /= l;\n    p.y /= l;\n  }\n  // ---\n\n  // return the utility object\n  return {\n    style: style,\n    lineWidth: lineWidth,\n    lineStringToPolygon: lineStringToPolygon,\n    multiLineStringToPolygon: multiLineStringToPolygon\n  };\n})();\n\nexport default HighwayUtils;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/HighwayUtils.js\n **/","/**\n * Worker Utils\n */\n\nvar WorkerUtils = (function() {\n\n  /** base directory */\n  var base = (function() {\n    var current = (function() {\n      if (document.currentScript) {\n        return document.currentScript.src;\n      } else {\n        var scripts = document.getElementsByTagName('script');\n        var script = scripts[scripts.length - 1];\n        if (script.src) {\n          return script.src;\n        }\n      }\n    })();\n    if (current) {\n      return dirname(current);\n    }\n  })();\n\n  /** Definition: Worker dependencies */\n  var dependencies = [\n    base + '/simultra-worker.js'\n  ];\n\n  /**\n   * Returns worker dependencies\n   *\n   * @returns {string[]}\n   */\n  var getDependencies = function() {\n    return dependencies;\n  };\n\n  // --- internal helper methods\n  function basename(path) {\n    return path.replace(/\\\\/g, '/').replace(/.*\\//, '');\n  }\n  function dirname(path) {\n    return path.replace(/\\\\/g, '/').replace(/\\/[^\\/]*$/, '');;\n  }\n  // ---\n\n  // return the utility object\n  return {\n    getDependencies: getDependencies\n  };\n})();\n\nexport default WorkerUtils;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/WorkerUtils.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\n\nimport BuildingUtils from '../util/BuildingUtils';\n\nclass BuildingLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {\n\n    };\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._setup();\n  }\n\n  _setup() {\n\n    // Buildings from Mapzen\n    // var viziLayer = VIZI.topoJSONTileLayer('https://vector.mapzen.com/osm/buildings/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n    var viziLayer = VIZI.topoJSONTileLayer('https://tile.mapzen.com/mapzen/vector/v1/buildings/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n      interactive: false,\n      maxLOD: 14,\n      style: function(feature) {\n        return BuildingUtils.style(feature, {\n          height: 1,\n          lineColor: '#f7c616',\n          lineWidth: 1,\n          lineTransparent: true,\n          lineOpacity: 0.2,\n          lineBlending: THREE.AdditiveBlending,\n          lineRenderOrder: 2\n        });\n      },\n      filter: function(feature) {\n        // Don't show points\n        return feature.geometry.type !== 'Point';\n      },\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, <a href=\"http://whosonfirst.mapzen.com#License\">Who\\'s On First</a>.'\n    });\n\n    // set the instance properties\n    this._setViziLayer(viziLayer);\n\n  }\n}\n\nexport default BuildingLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/BuildingLayer.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\nimport FootwayUtils from '../util/FootwayUtils';\n\nclass FootwayLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {\n\n    };\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._setup();\n  }\n\n  _setup() {\n\n    var self = this;\n\n    // Landuses from Mapzen\n    // var viziLayer = VIZI.topoJSONTileLayer('https://vector.mapzen.com/osm/landuse,roads/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n    var viziLayer = VIZI.topoJSONTileLayer('https://tile.mapzen.com/mapzen/vector/v1/landuse,roads/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n      interactive: false,\n      maxLOD: 18,\n      style: function(feature) {\n        if (feature.properties.lanes) {\n          console.log(feature);\n        }\n        if (feature.properties.width) {\n          console.log(feature);\n        }\n\n        return FootwayUtils.style(feature, {\n          height: 0.5\n        });\n      },\n      filter: function(feature) {\n        // Don't show points\n        if (feature.geometry.type === 'Point') {\n          return false;\n        }\n\n        // pedestrian (Polygon)\n        if (feature.properties.kind === 'pedestrian') {\n          return true;\n        }\n\n        // footway (LineString)\n        if (feature.properties.highway === 'footway') {\n          return true;\n        }\n\n        return false;\n      },\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, <a href=\"http://whosonfirst.mapzen.com#License\">Who\\'s On First</a>.'\n    });\n\n    // set the instance properties\n    this._setViziLayer(viziLayer);\n\n  }\n}\n\nexport default FootwayLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/FootwayLayer.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\n\nimport HighwayUtils from '../util/HighwayUtils';\n\nclass HighwayLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {};\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._setup();\n  }\n\n  _setup() {\n\n    var self = this;\n\n    // Roads from Mapzen\n    // var viziLayer = VIZI.topoJSONTileLayer('https://vector.mapzen.com/osm/roads/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n    var viziLayer = VIZI.topoJSONTileLayer('https://tile.mapzen.com/mapzen/vector/v1/roads/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n      interactive: false,\n      maxLOD: 18,\n      style: function(feature) {\n        if (feature.properties.lanes) {\n          console.log(feature);\n        }\n        if (feature.properties.width) {\n          console.log(feature);\n        }\n\n        return HighwayUtils.style(feature, {\n          height: 0,\n          opacity: 0.2\n        });\n      },\n      filter: function(feature) {\n        // Don't show points\n        if (feature.geometry.type === 'Point') {\n          return false;\n        }\n\n        // Convert LineString to polygon\n        if (feature.geometry.type === 'LineString') {\n          var lineWidth = HighwayUtils.lineWidth(feature, 1.0);\n          var outCoordss = HighwayUtils.lineStringToPolygon(self._getViziWorld(), feature.geometry.coordinates, lineWidth);\n\n          feature.geometry.type = 'MultiPolygon';\n          feature.geometry.coordinates = outCoordss;\n        }\n        // Convert MultiLineString to Polygon\n        else if (feature.geometry.type === 'MultiLineString') {\n          var lineWidth = HighwayUtils.lineWidth(feature, 1.0);\n          var outCoordss = HighwayUtils.multiLineStringToPolygon(self._getViziWorld(), feature.geometry.coordinates, lineWidth);\n\n          feature.geometry.type = 'MultiPolygon';\n          feature.geometry.coordinates = outCoordss;\n        }\n\n        return true;\n      },\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, <a href=\"http://whosonfirst.mapzen.com#License\">Who\\'s On First</a>.'\n    });\n\n    // set the instance properties\n    this._setViziLayer(viziLayer);\n\n  }\n}\n\nexport default HighwayLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/HighwayLayer.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\n\nimport API from '../io/API';\n\nimport WorkerUtils from '../util/WorkerUtils';\n\nconst UPDATE_INTERVAL_MS = 1000;\n\nclass PedestrianLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {\n      renderer: 'cpu'\n    };\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._pedestrians = [];\n\n    this._setup();\n  }\n\n  _setup() {\n\n    // pedestrian layer\n    var viziLayer = VIZI.pedestrianLayer({\n      'monkey': {\n        file: {\n          body: '/javascripts/maps/json/monkey/monkey.json',\n        },\n        scale: 1.0,\n        translation: {x: 0, y: 0, z: 0},\n        rotation: {x: 0, y: 0, z: 0}\n      }\n    }, {\n      enableGpuComputation: this._options.renderer === 'gpu',\n      simWidth: 32,\n      style: {\n        height: 0\n      }\n    });\n\n    // set the instance property\n    this._setViziLayer(viziLayer);\n\n  }\n\n  _onAdd(simultra) {\n    super._onAdd(simultra);\n\n    // create the worker thread for websocket\n    this._worker = operative(this._createWorker(), WorkerUtils.getDependencies());\n  }\n\n  _onRemove() {\n    super._onRemove();\n\n    // destroy the worker\n    this._worker = null;\n  }\n\n  /**\n   * Starts updating the view\n   */\n  start() {\n    this._isRunning = true;\n\n    var self = this;\n\n    // start all of the workers\n    this._worker.start(this._createWorkerCallback());\n\n    // start pedestrian manager\n    var ws = this._api.wsPedestrians();\n    ws.onclose = function(event) {\n      console.log('closed pedestrian manager');\n    };\n    ws.onmessage = function(event) {\n      self._onMessage(event.data);\n    };\n    ws.onopen = function() {\n      console.log('opened pedestrian manager');\n    };\n    this._ws = ws;\n\n    setTimeout(function() { self._update(); }, 0);\n  }\n\n  /**\n   * Stops updating the view\n   */\n  stop() {\n    this._isRunning = false;\n\n    // terminate pedestrian manager\n    if (this._ws) {\n      this._ws.close();\n    }\n\n    // terminate all of the workers\n    this._worker.stop();\n  }\n\n  _onMessage(data) {\n    var self = this;\n    if (data === 'creation') {\n      setTimeout(function() { self._update(); }, 0);\n    } else if (data === 'deletion') {\n      setTimeout(function() { self._update(); }, 0);\n    } else {\n      console.error('unknown message ' + data);\n    }\n  }\n\n  // (rest)\n  // _update() {\n  //   var self = this;\n  //\n  //   if (this._isRunning) {\n  //\n  //     this._lastUpdatedAt = Date.now();\n  //\n  //     this._api.getPedestrians()\n  //       .then(function(data) {\n  //\n  //         self._performUpdate(data);\n  //\n  //       }).catch(function(err) {\n  //\n  //       console.error('Error updating the pedestrian layer:' + err);\n  //\n  //     }).then(function() {\n  //\n  //       if (self._isRunning) {\n  //         // calculate the delay\n  //         var lastUpdate = self._lastUpdatedAt;\n  //         var now = Date.now();\n  //         var delay = UPDATE_INTERVAL_MS - (now - lastUpdate);\n  //\n  //         // register the next update\n  //         setTimeout(function() { self._update(); }, (delay > 0) ? delay : 0);\n  //       }\n  //\n  //     });\n  //\n  //   }\n  // }\n\n  // (websocket)\n  _update() {\n    var self = this;\n\n    if (this._isRunning) {\n\n      this._lastUpdatedAt = Date.now();\n\n      this._api.getPedestrians()\n        .then(function(data) {\n\n          self._performUpdate(data);\n\n        }).catch(function(err) {\n\n        console.error('Error updating the pedestrian layer:' + err);\n\n      });\n    }\n  }\n\n  _performUpdate(data) {\n    var self = this;\n    var viziLayer = this._getViziLayer();\n\n    // map pedestrian parameters into dictionaries\n    data.forEach(pedestrian => {\n      // if pedestrian does not exist\n      if (!self._hasPedestrian(pedestrian)) {\n        // add to pedestrian layer\n        self._addPedestrian(pedestrian);\n      }\n    });\n\n  }\n\n  _hasPedestrian(pedestrian) {\n    return (pedestrian.id in this._pedestrians);\n  }\n\n  _addPedestrian(pedestrian) {\n    var viziLayer = this._getViziLayer();\n\n    // add pedestrian to the vizi layer\n    var object = viziLayer.addPedestrian(\n      pedestrian.type,\n      new VIZI.LatLon(pedestrian.location.lat, pedestrian.location.lon),\n      pedestrian.angle\n    );\n\n    // add entry to dictionary\n    var entry = {\n      data: pedestrian,\n      object: object\n    };\n    this._pedestrians[pedestrian.id] = entry;\n\n    console.log('added pedestrian: ' + JSON.stringify(pedestrian));\n    this.emit('onAddPedestrian', pedestrian.id, entry);\n    return entry;\n  }\n\n  // (websocket)\n  _createWorker() {\n    var baseUrl = this._api.baseUrl;\n    return {\n      _baseUrl: baseUrl,\n      _api: null,\n      _callback: null,\n      _isRunning: false,\n\n      /** start updating the pedestrian */\n      start: function(callback) {\n        this._api = new SimWorker.API(this._baseUrl);\n        this._callback = callback;\n        this._isRunning = true;\n\n        var self = this;\n        setTimeout(function() { self._update(); }, self._interval);\n      },\n\n      _update: function() {\n        var self = this;\n\n        var socket = this._api.wsAllPedestrians();\n        socket.onclose = function(event) {\n          self._isRunning = false;\n          console.log('closed pedestrian websocket');\n        };\n        socket.onmessage = function(event) {\n          // here, \"event\" is an instance of MessageEvent, which cannot be serialized to send to the UI thread,\n          // hence, we just extract the data object (sent by another peer) and transfer it to the UI thread.\n          // console.log(event.data);\n          if (event.data) {\n            self._callback(JSON.parse(event.data));\n          }\n        };\n        socket.onopen = function() {\n          console.log('opened pedestrian websocket');\n        };\n      },\n\n      /** stop updating */\n      stop: function() {\n        this._isRunning = false;\n      }\n    };\n  }\n\n  _createWorkerCallback() {\n    return (function(that) {\n      var scopes = {};\n      var defaultScope = {\n        prevSender: ''\n      };\n\n      return function(msg) {\n        var sender = msg.sender;\n        var pedestrian = msg.data;\n\n        // retrieve local scope for this pedestrian\n        var scope = (pedestrian.id in scopes) ? scopes[pedestrian.id] : (scopes[pedestrian.id] = extend({}, defaultScope));\n\n        // update the object in simultra\n        if (pedestrian.id in that._pedestrians) {\n          var entry = that._pedestrians[pedestrian.id];\n          entry.data = pedestrian;\n\n          var viziLayer = that._getViziLayer();\n\n          // update the object in vizi layer\n          if (scope.prevSender !== sender) {\n            viziLayer.setLabelClass(pedestrian.id, 'label pedestrian');\n            viziLayer.setLabelText(pedestrian.id, sender);\n          }\n          viziLayer.setLocation(pedestrian.id, pedestrian.location.lat, pedestrian.location.lon, -pedestrian.angle);\n          viziLayer.setVelocity(pedestrian.id, pedestrian.velocity, 0, 0, 0);\n\n          // emit\n          that.emit('onUpdatePedestrian', pedestrian.id, entry, sender);\n        }\n      };\n    })(this);\n  }\n\n  /**\n   * Sets the Simultra to focus on the specific vehicle\n   *\n   * @param id\n   */\n  focusOn(id) {\n    if (id in this._pedestrians) {\n      this._getSimultra().focusOn((function(self, id) {\n        return {\n          point: function() {\n            var position = self._vehicles[id].object.vehicle.root.position;\n            return new VIZI.Point(position.x, position.z);\n          }\n        };\n      })(this, id));\n    } else {\n      this._getSimultra().focusOn(null);\n    }\n  }\n\n}\n\nexport default PedestrianLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/PedestrianLayer.js\n **/","/**\n * API Helper\n */\nimport WebClient from './WebClient';\n\n// --- API endpoint definitions\nconst START_SIMULATION = '/api/v1/start';\nconst IS_RUNNING = '/api/v1/isRunning';\nconst STOP_SIMULATION = '/api/v1/stop';\n\nconst GET_VEHICLES = '/api/v1/vehicles';\nconst UPDATE_VEHICLES = '/api/v1/vehicles';\nconst GET_VEHICLE = function(vid) { return '/api/v1/vehicles/' + vid; };\nconst WS_VEHICLES = '/api/v1/vehicles-ws';\nconst WS_VEHICLE = function(vid) { return '/api/v1/vehicles/' + vid + '/ws'; };\n\nconst GET_PEDESTRIANS = '/api/v1/pedestrians';\nconst UPDATE_PEDESTRIANS = '/api/v1/pedestrians';\nconst GET_PEDESTRIAN = function(pid) { return '/api/v1/pedestrians/' + pid; };\nconst WS_PEDESTRIANS = '/api/v1/pedestrians-ws';\nconst WS_PEDESTRIAN = function(pid) { return '/api/v1/pedestrians/' + pid + '/ws'; };\n// ---\n\nclass API extends WebClient {\n  constructor(baseUrl) {\n    super();\n    this.baseUrl = baseUrl;\n    this.wsBaseUrl = baseUrl.replace(/^https?:\\/\\//, 'ws://');\n  }\n\n  // --- Controller\n  startSimulation(map, type, scenario) {\n    return this._ajax({\n      url: this.baseUrl + START_SIMULATION,\n      method: 'post',\n      data: JSON.stringify({\n        map: map,\n        type: type,\n        scenario: scenario\n      })\n    });\n  }\n\n  isRunning() {\n    return this._ajax({\n      url: this.baseUrl + IS_RUNNING,\n      method: 'get'\n    });\n  }\n\n  stopSimulation() {\n    return this._ajax({\n      url: this.baseUrl + STOP_SIMULATION,\n      method: 'post'\n    });\n  }\n\n  // --- Vehicles\n  getVehicles() {\n    return this._ajax({\n      url: this.baseUrl + GET_VEHICLES,\n      method: 'get'\n    });\n  }\n\n  updateVehicles(data) {\n    return this._ajax({\n      url: this.baseUrl + UPDATE_VEHICLES,\n      method: 'put',\n      data: data\n    });\n  }\n\n  getVehicle(vid) {\n    return this._ajax({\n      url: this.baseUrl + GET_VEHICLE(vid),\n      method: 'get'\n    });\n  }\n\n  wsVehicles() {\n    return new WebSocket(this.wsBaseUrl + WS_VEHICLES);\n  }\n\n  wsVehicle(vid) {\n    return new WebSocket(this.wsBaseUrl + WS_VEHICLE(vid));\n  }\n\n  wsAllVehicles() {\n    return this.wsVehicle('all');\n  }\n  // ---\n\n  // --- Pedestrians\n  getPedestrians() {\n    return this._ajax({\n      url: this.baseUrl + GET_PEDESTRIANS,\n      method: 'get'\n    });\n  }\n\n  updatePedestrians(data) {\n    return this._ajax({\n      url: this.baseUrl + UPDATE_PEDESTRIANS,\n      method: 'put',\n      data: data\n    });\n  }\n\n  getPedestrian(pid) {\n    return this._ajax({\n      url: this.baseUrl + GET_PEDESTRIAN(pid),\n      method: 'get'\n    });\n  }\n\n  wsPedestrians() {\n    return new WebSocket(this.wsBaseUrl + WS_PEDESTRIANS);\n  }\n\n  wsPedestrian(pid) {\n    return new WebSocket(this.wsBaseUrl + WS_PEDESTRIAN(pid));\n  }\n\n  wsAllPedestrians() {\n    return this.wsPedestrian('all');\n  }\n  // ---\n\n}\n\nexport default API;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/io/API.js\n **/","/**\n * Created by masayuki on 28/07/2016.\n */\nimport extend from 'extend';\n\nclass WebClient {\n  constructor() {\n\n  }\n\n  _ajax(param) {\n    var defaultParam = {\n      url: null,\n      method: 'GET',\n      data: null,\n      type: 'json'\n    };\n    param = extend({}, defaultParam, param);\n\n    return new Promise(function(resolve, reject) {\n      var method = param.method.toUpperCase();\n\n      var xhr = new XMLHttpRequest();\n      xhr.open(method, param.url);\n      xhr.responseType = param.type;\n\n      // set callbacks\n      xhr.onload = function() {\n        if (xhr.status === 200) {\n          resolve(xhr.response);\n        } else {\n          reject(Error(xhr.statusText));\n        }\n      };\n      xhr.onerror = function() {\n        reject(Error('Network Error'));\n      };\n\n      // send data if exists\n      if ((method === 'POST' || method === 'PUT') && param.data) {\n        xhr.send(param.data);\n      }\n      // or send the request without data\n      else {\n        xhr.send();\n      }\n    });\n  }\n\n}\n\nexport default WebClient;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/io/WebClient.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\nimport operative from 'operative';\n\nimport Layer from './Layer';\n\nimport API from '../io/API';\n\nimport WorkerUtils from '../util/WorkerUtils';\n\nconst UPDATE_INTERVAL_MS = 10000;\n\nclass VehicleLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {\n      renderer: 'cpu'\n    };\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._vehicles = [];\n\n    this._setup();\n  }\n\n  _setup() {\n\n    // car layer\n    var viziLayer = VIZI.vehicleLayer({\n      'veyron': {\n        file: {\n          body: '/javascripts/maps/objs/veyron/parts/veyron_body_bin.js',\n          wheel: '/javascripts/maps/objs/veyron/parts/veyron_wheel_bin.js'\n        },\n        textureFile: '/javascripts/maps/objs/veyron/texture.png',\n        scale: 0.025,\n        translation: {x: 0, y: 0, z: 0},\n        rotation: {x: 0, y: 90 * Math.PI / 180, z: 0}\n      }\n    }, {\n      enableGpuComputation: this._options.renderer === 'gpu',\n      simWidth: 32,\n      style: {\n        height: 0\n      }\n    });\n\n    // set the instance property\n    this._setViziLayer(viziLayer);\n\n  }\n\n  _onAdd(simultra) {\n    super._onAdd(simultra);\n\n    // create the worker thread for websocket\n    this._worker = operative(this._createWorker(), WorkerUtils.getDependencies());\n  }\n\n  _onRemove() {\n    super._onRemove();\n\n    // destroy the worker\n    this._worker = null;\n  }\n\n  /**\n   * Starts updating the view\n   */\n  start() {\n    this._isRunning = true;\n\n    var self = this;\n\n    // start the worker\n    this._worker.start(this._createWorkerCallback());\n\n    // start vehicle manager\n    var ws = this._api.wsVehicles();\n    ws.onclose = function(event) {\n      console.log('closed vehicle manager');\n    };\n    ws.onmessage = function(event) {\n      self._onMessage(event.data);\n    };\n    ws.onopen = function() {\n      console.log('opened vehicle manager');\n    };\n    this._ws = ws;\n\n    setTimeout(function() { self._update(); }, 0);\n  }\n\n  /**\n   * Stops updating the view\n   */\n  stop() {\n    this._isRunning = false;\n\n    // terminate vehicle manager\n    if (this._ws) {\n      this._ws.close();\n    }\n\n    // terminate all of the workers\n    this._worker.stop();\n  }\n\n  _onMessage(data) {\n    var self = this;\n    if (data === 'creation') {\n      setTimeout(function() { self._update(); }, 0);\n    } else if (data === 'deletion') {\n      setTimeout(function() { self._update(); }, 0);\n    } else {\n      console.error('unknown message ' + data);\n    }\n  }\n\n  // (rest)\n  // _update() {\n  //   var self = this;\n  //\n  //   if (this._isRunning) {\n  //\n  //     this._lastUpdatedAt = Date.now();\n  //\n  //     this._api.getVehicles()\n  //       .then(function(data) {\n  //\n  //         self._performUpdate(data);\n  //\n  //       }).catch(function(err) {\n  //\n  //       console.error('Error updating the vehicle layer: ' + err);\n  //\n  //     }).then(function() {\n  //\n  //       if (self._isRunning) {\n  //         // calculate the delay\n  //         var lastUpdate = self._lastUpdatedAt;\n  //         var now = Date.now();\n  //         var delay = UPDATE_INTERVAL_MS - (now - lastUpdate);\n  //\n  //         // register the next update\n  //         setTimeout(function() { self._update(); }, (delay > 0) ? delay : 0);\n  //       }\n  //\n  //     });\n  //\n  //   }\n  // }\n\n  // (websocket)\n  _update() {\n    var self = this;\n\n    if (this._isRunning) {\n\n      this._lastUpdatedAt = Date.now();\n\n      this._api.getVehicles()\n        .then(function(data) {\n\n          self._performUpdate(data);\n\n        }).catch(function(err) {\n\n          console.error('Error updating the vehicle layer: ' + err);\n\n        });\n\n    }\n  }\n\n  _performUpdate(data) {\n    var self = this;\n\n    // map vehicle parameters into dictionaries\n    data.forEach(vehicle => {\n      // if vehicle does not exist\n      if (!self._hasVehicle(vehicle)) {\n        // add to vehicle layer\n        self._addVehicle(vehicle);\n      }\n    });\n  }\n\n  _hasVehicle(vehicle) {\n    return (vehicle.id in this._vehicles);\n  }\n\n  _addVehicle(vehicle) {\n    var viziLayer = this._getViziLayer();\n\n    // add vehicle to the vizi layer\n    var object = viziLayer.addVehicle(\n      vehicle.type,\n      new VIZI.LatLon(vehicle.location.lat, vehicle.location.lon),\n      vehicle.angle\n    );\n\n    // add entry to dictionary\n    var entry = {\n      data: vehicle,\n      object: object\n    };\n    this._vehicles[vehicle.id] = entry;\n    // this._vehicles.push(entry);\n\n    console.log('added vehicle: ' + JSON.stringify(vehicle));\n    this.emit('onAddVehicle', vehicle.id, entry);\n    return entry;\n  }\n\n  // (rest)\n  // _createWorker() {\n  //   var baseUrl = this._api.baseUrl;\n  //   return {\n  //     _interval: 10,\n  //     _baseUrl: baseUrl,\n  //     _api: null,\n  //     _id: null,\n  //     _callback: null,\n  //     _isRunning: false,\n  //\n  //     /** start updating the vehicle */\n  //     start: function(id, callback) {\n  //       this._api = new SimWorker.API(this._baseUrl);\n  //       this._id = id;\n  //       this._callback = callback;\n  //       this._isRunning = true;\n  //\n  //       var self = this;\n  //       setTimeout(function() { self._update(); }, self._interval);\n  //     },\n  //\n  //     _update: function() {\n  //       var id = this._id;\n  //       var self = this;\n  //       this._api.getVehicle(id)\n  //         .then(function(data) {\n  //           self._callback(data);\n  //         })\n  //         .catch(function(err) {\n  //           console.error(err);\n  //         })\n  //         .then(function() {\n  //           if (self._isRunning) {\n  //             setTimeout(function() { self._update(); }, self._interval);\n  //           }\n  //         });\n  //     },\n  //\n  //     /** stop updating */\n  //     stop: function() {\n  //       this._isRunning = false;\n  //     }\n  //   };\n  // }\n\n  // (websocket)\n  _createWorker() {\n    var baseUrl = this._api.baseUrl;\n    return {\n      _baseUrl: baseUrl,\n      _api: null,\n      _socket: null,\n      _callback: null,\n      _isRunning: false,\n\n      /** start updating the vehicle */\n      start: function(callback) {\n        this._api = new SimWorker.API(this._baseUrl);\n        this._callback = callback;\n        this._isRunning = true;\n\n        var self = this;\n        setTimeout(function() { self._update(); }, 0);\n      },\n\n      _update: function() {\n        var self = this;\n\n        var socket = this._api.wsAllVehicles();\n        socket.onclose = function(event) {\n          self._isRunning = false;\n          console.log('closed vehicle websocket');\n        };\n        socket.onmessage = function(event) {\n          // here, \"event\" is an instance of MessageEvent, which cannot be serialized to send to the UI thread,\n          // hence, we just extract the data object (sent by another peer) and transfer it to the UI thread.\n          // console.log(event.data);\n          if (event.data) {\n            self._callback(JSON.parse(event.data));\n          }\n        };\n        socket.onopen = function() {\n          console.log('opened vehicle websocket');\n        };\n        self._socket = socket;\n      },\n\n      /** stop updating */\n      stop: function() {\n        this._isRunning = false;\n      }\n    };\n  }\n\n  _createWorkerCallback() {\n    return (function(that) {\n      var scopes = {};\n      var defaultScope = {\n        prevSender: ''\n      };\n\n      return function(msg) {\n        var sender = msg.sender;\n        var vehicle = msg.data;\n\n        // retrieve local scope for this vehicle\n        var scope = (vehicle.id in scopes) ? scopes[vehicle.id] : (scopes[vehicle.id] = extend({}, defaultScope));\n\n        // update the object in simultra\n        if (vehicle.id in that._vehicles) {\n          var entry = that._vehicles[vehicle.id];\n          entry.data = vehicle;\n\n          var viziLayer = that._getViziLayer();\n\n          // update the object in vizi layer\n          if (scope.prevSender !== sender) {\n            viziLayer.setLabelClass(vehicle.id, 'label vehicle');\n            viziLayer.setLabelText(vehicle.id, sender);\n            scope.prevSender = sender;\n          }\n          viziLayer.setLocation(vehicle.id, vehicle.location.lat, vehicle.location.lon, -vehicle.angle);\n          viziLayer.setVelocity(vehicle.id, vehicle.velocity, 0, 0, vehicle.wheel);\n\n          // emit\n          that.emit('onUpdateVehicle', vehicle.id, entry, sender);\n        }\n      };\n    })(this);\n  }\n\n  /**\n   * Returns the centroid of vehicles\n   */\n  getCentroid() {\n    if (this._vehicles.length > 0) {\n      // FIXME: calculate the centroid of all vehicles\n      // var location = this._vehicles[0].object.latlon;\n      if (this._vehicles[0].object.vehicle && this._vehicles[0].object.vehicle.root) {\n        var position = this._vehicles[0].object.vehicle.root.position;\n        var point = new VIZI.Point(position.x, position.z);\n        var latLon = this._getViziWorld().pointToLatLon(point);\n        return latLon; // {lat: 35.xxx, lon: 140.xxx}\n      } else {\n        return null;\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Sets the Simultra to focus on the specific vehicle\n   *\n   * @param id\n   */\n  focusOn(id) {\n    if (id in this._vehicles) {\n      this._getSimultra().focusOn((function(self, id) {\n        return {\n          point: function() {\n            var position = self._vehicles[id].object.vehicle.root.position;\n            return new VIZI.Point(position.x, position.z);\n          }\n        };\n      })(this, id));\n    } else {\n      this._getSimultra().focusOn(null);\n    }\n  }\n\n}\n\nexport default VehicleLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/VehicleLayer.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_20__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"operative\"\n ** module id = 20\n ** module chunks = 0\n **/"],"sourceRoot":""}