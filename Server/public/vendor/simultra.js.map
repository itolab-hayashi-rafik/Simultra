{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap a33c2fd1267362f66635","webpack:///./src/simultra.js","webpack:///external \"VIZI\"","webpack:///./~/eventemitter3/index.js","webpack:///./~/extend/index.js","webpack:///external \"Stats\"","webpack:///external \"THREEx\"","webpack:///external \"TweenLite\"","webpack:///./src/layer/BasemapLayer.js","webpack:///./src/layer/Layer.js","webpack:///./src/util/index.js","webpack:///./src/util/BuildingUtils.js","webpack:///./src/util/FootwayUtils.js","webpack:///./src/util/HighwayUtils.js","webpack:///./src/util/WorkerUtils.js","webpack:///./src/layer/BuildingLayer.js","webpack:///./src/layer/FootwayLayer.js","webpack:///./src/layer/HighwayLayer.js","webpack:///./src/layer/PedestrianLayer.js","webpack:///./src/io/API.js","webpack:///./src/io/WebClient.js","webpack:///./src/layer/VehicleLayer.js","webpack:///external \"operative\""],"names":["Simultra","baseUrl","defaultCoords","options","console","log","defaultOptions","debug","renderer","renderBasemap","renderHighway","renderFootway","renderBuilding","renderVehicle","renderPedestrian","fixCamera","_options","_api","_isRunning","_focusedObject","coords","_setupWorld","_setupLayers","_setupEvents","_setupDebug","self","world","skybox","postProcessing","setView","_environment","_skybox","setInclination","camera","getCamera","position","set","control","Controls","orbit","addTo","_control","on","delta","_onWorldUpdate","_world","_basemapLayer","_highwayLayer","_footwayLayer","_buildingLayer","_vehicleLayer","_pedestrianLayer","id","entry","emit","sender","stats","dom","style","top","zIndex","document","body","appendChild","_stats","RendererStats","rendererStats","domElement","left","bottom","_rendererStats","update","_engine","_renderer","_updateCameraPosition","latLon","point","latLonToPoint","lookAtPoint","pointToLatLon","target","_controls","moveTarget","THREE","Vector3","x","y","copy","Point","z","moveToPoint","offset","sub","add","time","zoom","flyToLatLon","flyToPoint","start","stop","map","type","scenario","startSimulation","isRunning","stopSimulation","object","lookAtLatLon","moveToLatLon","animate","Error","counter","a","focusedOn","to","onUpdate","focusOn","LatLon","lat","lon","onComplete","ease","Circ","easeInOut","vid","pid","window","BasemapLayer","_setup","viziLayer","imageTileLayer","attribution","_setViziLayer","Layer","_viziLayer","_simultra","simultra","undefined","_onAdd","removeLayer","_onRemove","Util","BuildingUtils","FootwayUtils","HighwayUtils","WorkerUtils","feature","defaultValue","height","properties","Math","random","defaultValues","geometry","color","transparent","opacity","lineColor","lineWidth","lineTransparent","lineOpacity","lineBlending","AdditiveBlending","lineRenderOrder","pointWidth","pointHeight","pointColor","HIGHWAY_COLOR_MAP","KIND_COLOR_MAP","HIGHWAY_WIDTH_MAP","highway","info","kind","width","lineStringToPolygon","multiLineStringToPolygon","coordss","cLatLon","pLatLon","nLatLon","cGeoCoord","pGeoCoord","nGeoCoord","vVert","_vVert","vMean","vPadding","_vPadding","p","_p","outCoordss","forEach","outCoords","i","length","normalize","splice","idx","push","l","sqrt","pow","base","current","currentScript","src","scripts","getElementsByTagName","script","dirname","dependencies","getDependencies","basename","path","replace","BuildingLayer","topoJSONTileLayer","interactive","maxLOD","filter","FootwayLayer","lanes","HighwayLayer","_getViziWorld","coordinates","UPDATE_INTERVAL_MS","PedestrianLayer","_pedestrians","pedestrianLayer","file","scale","translation","rotation","enableGpuComputation","simWidth","_worker","operative","_createWorker","_createWorkerCallback","ws","wsPedestrians","onclose","event","onmessage","_onMessage","data","onopen","_ws","setTimeout","_update","close","error","_lastUpdatedAt","Date","now","getPedestrians","then","_performUpdate","catch","err","_getViziLayer","_hasPedestrian","pedestrian","_addPedestrian","addPedestrian","location","angle","JSON","stringify","_baseUrl","_callback","callback","SimWorker","API","_interval","socket","wsAllPedestrians","parse","that","scopes","defaultScope","prevSender","msg","scope","setLabelClass","setLabelText","setLocation","setVelocity","velocity","_getSimultra","root","START_SIMULATION","IS_RUNNING","STOP_SIMULATION","GET_VEHICLES","UPDATE_VEHICLES","GET_VEHICLE","WS_VEHICLES","WS_VEHICLE","GET_PEDESTRIANS","UPDATE_PEDESTRIANS","GET_PEDESTRIAN","WS_PEDESTRIANS","WS_PEDESTRIAN","wsBaseUrl","_ajax","url","method","WebSocket","wsVehicle","wsPedestrian","WebClient","param","defaultParam","Promise","resolve","reject","toUpperCase","xhr","XMLHttpRequest","open","responseType","onload","status","response","statusText","onerror","send","VehicleLayer","_vehicles","vehicleLayer","wheel","textureFile","PI","wsVehicles","getVehicles","_hasVehicle","vehicle","_addVehicle","addVehicle","_socket","wsAllVehicles"],"mappings":"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AAED;;;;;;;;uCAKkBC,G,EAAK;AACrB;AACA,YAAK1E,gBAAL,IAAyB,KAAKA,gBAAL,CAAsBiE,OAAtB,CAA8BS,GAA9B,CAAzB;AACD;;;;;;mBAGY7H,Q;;AACf8H,QAAO9H,QAAP,GAAkBA,QAAlB,C;;;;;;ACnWA,gD;;;;;;ACAA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAW,SAAS;AACpB,YAAW,MAAM;AACjB,YAAW,QAAQ;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;;AAEzB;AACA;AACA;AACA,WAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,QAAQ;AACnB,cAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,2DAA0D,OAAO;AACjE;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0CAAyC,SAAS;AAClD;AACA;;AAEA;AACA,IAAG;AACH;AACA;;AAEA,gBAAe,YAAY;AAC3B;;AAEA;AACA,4DAA2D;AAC3D,gEAA+D;AAC/D,oEAAmE;AACnE;AACA,2DAA0D,SAAS;AACnE;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,SAAS;AACpB,YAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;;AAEA,gDAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,SAAS;AACpB,YAAW,MAAM;AACjB;AACA;AACA;AACA;AACA;;AAEA,gDAA+C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,SAAS;AACpB,YAAW,MAAM;AACjB,YAAW,QAAQ;AACnB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,iDAAgD,YAAY;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,YAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA,kCAAiC;;AAEjC;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;AChSA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oBAAmB;;AAEnB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;;AAEA,QAAO,YAAY;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;;AAEA;AACA;;AAEA;AACA,OAAM;AACN;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;ACpFA,gD;;;;;;ACAA,gD;;;;;;ACAA,gD;;;;;;;;;;;;;;ACAA;;;;AACA;;;;AAEA;;;;AAEA;;;;;;;;;;;;KAEM+H,Y;;;AACJ,yBAAY5H,OAAZ,EAAqB;AAAA;;AACnB,SAAIG,iBAAiB,EAArB;;AAEA,SAAIU,WAAW,sBAAO,EAAP,EAAWV,cA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","file":"simultra.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"VIZI\"), require(\"Stats\"), require(\"THREEx\"), require(\"TweenLite\"), require(\"operative\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"VIZI\", \"Stats\", \"THREEx\", \"TweenLite\", \"operative\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Simultra\"] = factory(require(\"VIZI\"), require(\"Stats\"), require(\"THREEx\"), require(\"TweenLite\"), require(\"operative\"));\n\telse\n\t\troot[\"Simultra\"] = factory(root[\"VIZI\"], root[\"Stats\"], root[\"THREEx\"], root[\"TweenLite\"], root[\"operative\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_21__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap a33c2fd1267362f66635\n **/","import VIZI from 'vizi';\nimport EventEmitter from 'eventemitter3';\nimport extend from 'extend';\nimport Stats from 'stats';\nimport THREEx from 'threex';\nimport TweenLite from 'TweenLite';\n\nimport BasemapLayer from './layer/BasemapLayer';\nimport BuildingLayer from './layer/BuildingLayer';\nimport FootwayLayer from './layer/FootwayLayer';\nimport HighwayLayer from './layer/HighwayLayer';\nimport PedestrianLayer from './layer/PedestrianLayer';\nimport VehicleLayer from './layer/VehicleLayer';\n\nimport API from './io/API';\nimport Util from './util/index';\n\nclass Simultra extends EventEmitter {\n  constructor(baseUrl, defaultCoords, options) {\n    super(); console.log(TweenLite);\n\n    var defaultOptions = {\n      debug: true,\n      renderer: 'cpu',\n      renderBasemap: true,\n      renderHighway: true,\n      renderFootway: true,\n      renderBuilding: true,\n      renderVehicle: true,\n      renderPedestrian: true,\n      fixCamera: false,\n    };\n    this._options = extend({}, defaultOptions, options);\n\n    this._api = new API(baseUrl);\n    this._isRunning = false;\n\n    this._focusedObject = null;\n\n    var coords = defaultCoords || [35.156324, 136.923108];\n\n    this._setupWorld(coords);\n    this._setupLayers();\n    this._setupEvents();\n    this._setupDebug();\n  }\n\n  _setupWorld(coords) {\n    var self = this;\n\n    // create a world\n    var world = VIZI.world('world', {\n      skybox: true,\n      postProcessing: false\n    }).setView(coords);\n    world._environment._skybox.setInclination(0.1);\n\n    // obtain the camera\n    var camera = world.getCamera();\n    camera.position.set(-150, 175, 125);\n\n    // Add controls\n    var control = VIZI.Controls.orbit().addTo(world);\n    this._control = control;\n\n    // add callbacks\n    world.on('preUpdate', function(delta) {\n      self._onWorldUpdate(delta);\n    });\n\n    // set the instance properties\n    this._world = world;\n  }\n\n  _setupLayers() {\n    // Basemap\n    this._basemapLayer    = this._options.renderBasemap    ? new BasemapLayer(this._options).addTo(this)    : null;\n    // Highway\n    this._highwayLayer    = this._options.renderHighway    ? new HighwayLayer(this._options).addTo(this)    : null;\n    // Footway\n    this._footwayLayer    = this._options.renderFootway    ? new FootwayLayer(this._options).addTo(this)    : null;\n    // Building\n    this._buildingLayer   = this._options.renderBuilding   ? new BuildingLayer(this._options).addTo(this)   : null;\n    // Vehicle\n    this._vehicleLayer    = this._options.renderVehicle    ? new VehicleLayer(this._options).addTo(this)    : null;\n    // Pedestrian\n    this._pedestrianLayer = this._options.renderPedestrian ? new PedestrianLayer(this._options).addTo(this) : null;\n  }\n\n  _setupEvents() {\n    var self = this;\n\n    // Vehicle\n    if (this._vehicleLayer) {\n      this._vehicleLayer.on('onAddVehicle', function(id, entry) { self.emit('onAddVehicle', id, entry); });\n      this._vehicleLayer.on('onUpdateVehicle', function(id, entry, sender) { self.emit('onUpdateVehicle', id, entry, sender); });\n    }\n    // Pedestrian\n    if (this._pedestrianLayer) {\n      this._pedestrianLayer.on('onAddPedestrian', function(id, entry) { self.emit('onAddPedestrian', id, entry); });\n      this._pedestrianLayer.on('onUpdatePedestrian', function(id, entry, sender) { self.emit('onUpdatePedestrian', id, entry, sender); });\n    }\n  }\n\n  _setupDebug() {\n    if (this._options.debug) {\n      // Stats\n      if (typeof Stats === 'function') {\n        var stats = new Stats();\n        stats.dom.style.position = 'absolute';\n        stats.dom.style.top = '0px';\n        stats.dom.style.zIndex = 100;\n        document.body.appendChild(stats.dom);\n        this._stats = stats;\n      }\n\n      // THREEx.RendererStats\n      if (typeof THREEx.RendererStats === 'function') {\n        var rendererStats = new THREEx.RendererStats();\n        rendererStats.domElement.style.position = 'absolute';\n        rendererStats.domElement.style.left = '0px';\n        rendererStats.domElement.style.bottom   = '0px';\n        document.body.appendChild(rendererStats.domElement);\n        this._rendererStats = rendererStats;\n      }\n    }\n  }\n\n  _onWorldUpdate(delta) {\n    // for debugging\n    if (this._options.debug) {\n      // Stats\n      if (this._stats) {\n        this._stats.update();\n      }\n\n      // RenderStats\n      if (this._rendererStats) {\n        this._rendererStats.update(this._world._engine._renderer);\n      }\n    }\n\n    // focus\n    this._updateCameraPosition();\n  }\n\n  lookAtLatLon(latLon) {\n    if (latLon) {\n      var point = this._world.latLonToPoint(latLon);\n      this.lookAtPoint(point);\n    }\n\n    var point = this.lookAtPoint();\n    return this._world.pointToLatLon(point);\n  }\n\n  lookAtPoint(point) {\n    if (point) {\n      // camera.lookAt(moveTarget); // TODO: this does not work. OrbitControl.js overrides this function!!\n\n      // camera ref\n      var camera = this._world.getCamera();\n      var target = this._control._controls.target;\n\n      // target to move to\n      var moveTarget = new THREE.Vector3(point.x, 0, point.y);\n\n      // apply!\n      target.copy(moveTarget);\n    }\n\n    var target = this._control._controls.target;\n    return new VIZI.Point(target.x, target.z);\n  }\n\n  moveToLatLon(latLon) {\n    var point = this._world.latLonToPoint(latLon);\n    this.moveToPoint(point);\n  }\n\n  moveToPoint(point) {\n    // camera ref\n    var camera = this._world.getCamera();\n    var target = this._control._controls.target;\n\n    // camera offset\n    var offset = new THREE.Vector3();\n    offset.copy(camera.position).sub(target);\n\n    // target to move to\n    var moveTarget = new THREE.Vector3(point.x, 0, point.y);\n\n    // apply!\n    target.copy(moveTarget);\n    camera.position.copy(target).add(offset);\n  }\n\n  /**\n   * Sets the center coordinate of the view\n   * @param lat latitude\n   * @param lon longitude\n   */\n  flyToLatLon(latLon, time, zoom) {\n    this._control.flyToLatLon(latLon, time, zoom);\n  }\n\n  /**\n   * Flyies to the point\n   * @param point\n   */\n  flyToPoint(point, time, zoom) {\n    this._control.flyToPoint(point, time, zoom);\n  }\n\n  /**\n   * Starts updating the view\n   */\n  start() {\n    this._vehicleLayer    && this._vehicleLayer.start();\n    this._pedestrianLayer && this._pedestrianLayer.start();\n    this._isRunning = true;\n  }\n\n  /**\n   * Stops updating the view\n   */\n  stop() {\n    this._vehicleLayer    && this._vehicleLayer.stop();\n    this._pedestrianLayer && this._pedestrianLayer.stop();\n    this._isRunning = false;\n  }\n\n  /**\n   * Returns if the view updating loop is running\n   *\n   * @returns {boolean}\n   */\n  isRunning() {\n    return this._isRunning;\n  }\n\n  /**\n   * Controls the remote to start the simulation\n   *\n   * @param map\n   * @param type\n   * @param scenario\n   */\n  startSimulation(map, type, scenario) {\n    return this._api.startSimulation(map, type, scenario);\n  }\n\n  /**\n   * Returns if the simulation is running\n   * @returns {*}\n   */\n  isSimulationRunning() {\n    return this._api.isRunning();\n  }\n\n  /**\n   * Controls the remote to stop the simulation\n   */\n  stopSimulation() {\n    return this._api.stopSimulation();\n  }\n\n  /**\n   * Updates the camera position to follow the vehicles\n   *\n   * @private\n   */\n  _updateCameraPosition() {\n    if (this._focusedObject != null) {\n      var object = this._focusedObject;\n      var latLon = !('latLon' in object) ? null : (typeof object.latLon === 'function') ? object.latLon() : object.latLon;\n      var point = !('point' in object) ? null : (typeof object.point === 'function') ? object.point() : object.point;\n\n      if (latLon != null) {\n        this._options.fixCamera ? this.lookAtLatLon(latLon) : this.moveToLatLon(latLon);\n      } else if (point != null) {\n        this._options.fixCamera ? this.lookAtPoint(point) : this.moveToPoint(point);\n      }\n    }\n  }\n\n  /**\n   * Focuses on an object\n   *\n   * @param object an object that has either a function or property named \"latLon\" that returns VIZI.LatLon location or \"point\" that returns VIZI.point position\n   */\n  focusOn(object, animate) {\n    animate = animate || true;\n\n    if (object != null && !('latLon' in object) && !('point' in object)) {\n      throw new Error('object needs to have a property or function named \"latLon\" that returns VIZI.LatLon location or \"point\" that returns VIZI.Point position');\n    }\n\n    if (animate) {\n      (function(self, object) {\n        var counter = { a: 0.0 };\n        var focusedOn = {\n          latLon: self.lookAtLatLon(),\n          point: self.lookAtPoint()\n        };\n\n        TweenLite.to(counter, 1, {\n          a: 1.0,\n          onUpdate: function() {\n            console.log('updating');\n            var focusOn = {\n              latLon: !('latLon' in object) ? null : (typeof object.latLon === 'function') ? object.latLon() : object.latLon,\n              point: !('point' in object) ? null : (typeof object.point === 'function') ? object.point() : object.point\n            };\n\n            if (focusOn.latLon != null) {\n              self._focusedObject = { latLon: new VIZI.LatLon(focusedOn.latLon.lat * (1.0 - counter.a) + focusOn.latLon.lat * counter.a, focusedOn.latLon.lon * (1.0 - counter.a) + focusOn.latLon.lon * counter.a) };\n            } else if (focusOn.point != null) {\n              self._focusedObject = { point: new VIZI.Point(focusedOn.point.x * (1.0 - counter.a) + focusOn.point.x * counter.a, focusedOn.point.y * (1.0 - counter.a) + focusOn.point.y * counter.a) };\n            }\n          },\n          onComplete: function() {\n            console.log('completed');\n            self._focusedObject = object;\n          },\n          ease: Circ.easeInOut\n        });\n      })(this, object);\n    } else {\n      this._focusedObject = object;\n    }\n  }\n\n  /**\n   * Focuses on a vehicle\n   *\n   * @param vid\n   */\n  focusOnVehicle(vid) {\n    // proxy VehicleLayer#focusOn()\n    this._vehicleLayer && this._vehicleLayer.focusOn(vid);\n  }\n\n  /**\n   * Focuses on a pedestrian\n   *\n   * @param pid\n   */\n  focusOnPedestrian(pid) {\n    // proxy PedestrianLayer#focusOn()\n    this._pedestrianLayer && this._pedestrianLayer.focusOn(pid);\n  }\n}\n\nexport default Simultra;\nwindow.Simultra = Simultra;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/simultra.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"VIZI\"\n ** module id = 1\n ** module chunks = 0\n **/","'use strict';\n\nvar has = Object.prototype.hasOwnProperty;\n\n//\n// We store our EE objects in a plain object whose properties are event names.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// `~` to make sure that the built-in object properties are not overridden or\n// used as an attack vector.\n// We also assume that `Object.create(null)` is available when the event name\n// is an ES6 Symbol.\n//\nvar prefix = typeof Object.create !== 'function' ? '~' : false;\n\n/**\n * Representation of a single EventEmitter function.\n *\n * @param {Function} fn Event handler to be called.\n * @param {Mixed} context Context for function execution.\n * @param {Boolean} [once=false] Only emit once\n * @api private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Minimal EventEmitter interface that is molded against the Node.js\n * EventEmitter interface.\n *\n * @constructor\n * @api public\n */\nfunction EventEmitter() { /* Nothing to set */ }\n\n/**\n * Hold the assigned EventEmitters by name.\n *\n * @type {Object}\n * @private\n */\nEventEmitter.prototype._events = undefined;\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @api public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var events = this._events\n    , names = []\n    , name;\n\n  if (!events) return names;\n\n  for (name in events) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return a list of assigned event listeners.\n *\n * @param {String} event The events that should be listed.\n * @param {Boolean} exists We only need to know if there are listeners.\n * @returns {Array|Boolean}\n * @api public\n */\nEventEmitter.prototype.listeners = function listeners(event, exists) {\n  var evt = prefix ? prefix + event : event\n    , available = this._events && this._events[evt];\n\n  if (exists) return !!available;\n  if (!available) return [];\n  if (available.fn) return [available.fn];\n\n  for (var i = 0, l = available.length, ee = new Array(l); i < l; i++) {\n    ee[i] = available[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Emit an event to all registered event listeners.\n *\n * @param {String} event The name of the event.\n * @returns {Boolean} Indication if we've emitted an event.\n * @api public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events || !this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if ('function' === typeof listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Register a new EventListener for the given event.\n *\n * @param {String} event Name of the event.\n * @param {Function} fn Callback function.\n * @param {Mixed} [context=this] The context of the function.\n * @api public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  var listener = new EE(fn, context || this)\n    , evt = prefix ? prefix + event : event;\n\n  if (!this._events) this._events = prefix ? {} : Object.create(null);\n  if (!this._events[evt]) this._events[evt] = listener;\n  else {\n    if (!this._events[evt].fn) this._events[evt].push(listener);\n    else this._events[evt] = [\n      this._events[evt], listener\n    ];\n  }\n\n  return this;\n};\n\n/**\n * Add an EventListener that's only called once.\n *\n * @param {String} event Name of the event.\n * @param {Function} fn Callback function.\n * @param {Mixed} [context=this] The context of the function.\n * @api public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  var listener = new EE(fn, context || this, true)\n    , evt = prefix ? prefix + event : event;\n\n  if (!this._events) this._events = prefix ? {} : Object.create(null);\n  if (!this._events[evt]) this._events[evt] = listener;\n  else {\n    if (!this._events[evt].fn) this._events[evt].push(listener);\n    else this._events[evt] = [\n      this._events[evt], listener\n    ];\n  }\n\n  return this;\n};\n\n/**\n * Remove event listeners.\n *\n * @param {String} event The event we want to remove.\n * @param {Function} fn The listener that we need to find.\n * @param {Mixed} context Only remove listeners matching this context.\n * @param {Boolean} once Only remove once listeners.\n * @api public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events || !this._events[evt]) return this;\n\n  var listeners = this._events[evt]\n    , events = [];\n\n  if (fn) {\n    if (listeners.fn) {\n      if (\n           listeners.fn !== fn\n        || (once && !listeners.once)\n        || (context && listeners.context !== context)\n      ) {\n        events.push(listeners);\n      }\n    } else {\n      for (var i = 0, length = listeners.length; i < length; i++) {\n        if (\n             listeners[i].fn !== fn\n          || (once && !listeners[i].once)\n          || (context && listeners[i].context !== context)\n        ) {\n          events.push(listeners[i]);\n        }\n      }\n    }\n  }\n\n  //\n  // Reset the array, or remove it completely if we have no more listeners.\n  //\n  if (events.length) {\n    this._events[evt] = events.length === 1 ? events[0] : events;\n  } else {\n    delete this._events[evt];\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners or only the listeners for the specified event.\n *\n * @param {String} event The event want to remove all listeners for.\n * @api public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  if (!this._events) return this;\n\n  if (event) delete this._events[prefix ? prefix + event : event];\n  else this._events = prefix ? {} : Object.create(null);\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// This function doesn't apply anymore.\n//\nEventEmitter.prototype.setMaxListeners = function setMaxListeners() {\n  return this;\n};\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/eventemitter3/index.js\n ** module id = 2\n ** module chunks = 0\n **/","'use strict';\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\n\nvar isArray = function isArray(arr) {\n\tif (typeof Array.isArray === 'function') {\n\t\treturn Array.isArray(arr);\n\t}\n\n\treturn toStr.call(arr) === '[object Array]';\n};\n\nvar isPlainObject = function isPlainObject(obj) {\n\tif (!obj || toStr.call(obj) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tvar hasOwnConstructor = hasOwn.call(obj, 'constructor');\n\tvar hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) {/**/}\n\n\treturn typeof key === 'undefined' || hasOwn.call(obj, key);\n};\n\nmodule.exports = function extend() {\n\tvar options, name, src, copy, copyIsArray, clone,\n\t\ttarget = arguments[0],\n\t\ti = 1,\n\t\tlength = arguments.length,\n\t\tdeep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === 'boolean') {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t} else if ((typeof target !== 'object' && typeof target !== 'function') || target == null) {\n\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\toptions = arguments[i];\n\t\t// Only deal with non-null/undefined values\n\t\tif (options != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = target[name];\n\t\t\t\tcopy = options[name];\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target !== copy) {\n\t\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\t\ttarget[name] = extend(deep, clone, copy);\n\n\t\t\t\t\t// Don't bring in undefined values\n\t\t\t\t\t} else if (typeof copy !== 'undefined') {\n\t\t\t\t\t\ttarget[name] = copy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/extend/index.js\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"Stats\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_5__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"THREEx\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"TweenLite\"\n ** module id = 6\n ** module chunks = 0\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\n\nimport Util from '../util/index';\n\nclass BasemapLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {};\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._setup();\n  }\n\n  _setup() {\n    // CartoDB basemap\n    var viziLayer = VIZI.imageTileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>'\n    });\n\n    this._setViziLayer(viziLayer);\n  }\n}\n\nexport default BasemapLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/BasemapLayer.js\n **/","import VIZI from 'vizi';\nimport EventEmitter from 'eventemitter3';\n\n/**\n * Base Layer class\n */\nclass Layer extends EventEmitter {\n  constructor(options) {\n    super();\n\n    // delegate layer\n    this._viziLayer = null;\n    this._options = options;\n\n    this._simultra = null;\n    this._api = null;\n  }\n\n  _setViziLayer(viziLayer) {\n    this._viziLayer = viziLayer;\n  }\n\n  _getViziLayer() {\n    return this._viziLayer;\n  }\n\n  _getViziWorld() {\n    return this._simultra._world;\n  }\n\n  _getSimultra() {\n    return this._simultra;\n  }\n\n  addTo(simultra) {\n    if (this._viziLayer === undefined) {\n      throw new Error('Layer not initialized');\n    }\n    if (simultra._world === undefined) {\n      throw new Error('Simultra not initialized');\n    }\n\n    this._simultra = simultra;\n    this._onAdd(simultra);\n\n    this._viziLayer.addTo(simultra._world);\n\n    return this;\n  }\n\n  _onAdd(simultra) {\n    this._api = simultra._api;\n  }\n\n  remove() {\n    if (this._viziLayer && this._simultra._world) {\n      this._simultra._world.removeLayer(this._viziLayer);\n    }\n\n    this._simultra = null;\n    this._onRemove();\n\n    return this;\n  }\n\n  _onRemove() {\n    // do something when this layer is removed from simultra\n  }\n}\n\nexport default Layer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/Layer.js\n **/","/**\n * Utility\n */\nimport BuildingUtils from './BuildingUtils';\nimport FootwayUtils from './FootwayUtils';\nimport HighwayUtils from './HighwayUtils';\nimport WorkerUtils from './WorkerUtils';\n\nconst Util = {};\n\nUtil.BuildingUtils = BuildingUtils;\nUtil.FootwayUtils = FootwayUtils;\nUtil.HighwayUtils = HighwayUtils;\nUtil.WorkerUtils = WorkerUtils;\n\nexport default Util;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/index.js\n **/","/**\n * Building Utilities\n */\nimport VIZI from 'vizi';\nimport extend from 'extend';\n\nvar BuildingUtils = (function() {\n\n  /**\n   * Return the style for a specific building\n   *\n   * @param {Object} feature\n   * @param {Object} defaultValue\n   */\n  var style = function(feature, defaultValue) {\n    var height;\n\n    if (feature.properties.height) {\n      height = feature.properties.height;\n    } else {\n      height = 10 + Math.random() * 10;\n    }\n\n    // construct the style\n    var style = {\n      height: height || defaultValue.height\n    };\n\n    return extend({}, defaultValue, style);\n  };\n\n  // return the utility object\n  return {\n    style: style\n  };\n})();\n\nexport default BuildingUtils;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/BuildingUtils.js\n **/","/**\n * Footway Utilities\n */\nimport VIZI from 'vizi';\nimport extend from 'extend';\n\nvar FootwayUtils = (function() {\n\n  /**\n   * Return the style for a specific footway\n   *\n   * @param {Object} feature\n   * @param {Object} defaultValues\n   */\n  var style = function(feature, defaultValues) {\n    var style;\n\n    // Polygon\n    if (feature.geometry.type === 'Polygon') {\n      style = {\n        color: '#ecebe9',\n        transparent: true,\n        opacity: 0.2\n      };\n    }\n    // Line\n    else if (feature.geometry.type === 'LineString') {\n      style = {\n        lineColor: '#cad9d4',\n        lineWidth: 1,\n        lineTransparent: true,\n        lineOpacity: 0.2,\n        lineBlending: THREE.AdditiveBlending,\n        lineRenderOrder: 2\n      };\n    }\n    // Point\n    else {\n      style = {\n        pointWidth: 1.0,\n        pointHeight: 1.0,\n        pointColor: '#0000ff'\n      };\n    }\n\n    return extend({}, defaultValues, style);\n  };\n\n  // return utility object\n  return {\n    style: style\n  };\n})();\n\nexport default FootwayUtils;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/FootwayUtils.js\n **/","/**\n * Highway Utilities\n */\nimport VIZI from 'vizi';\nimport extend from 'extend';\n\n// --- constants\n// jscs:disable disallowSpaceAfterObjectKeys\nconst HIGHWAY_COLOR_MAP = {\n  'motorway'      : '#9e250e', // express way\n  'major'         : '#f7c616', // main road\n  'primary'       : '#ffe104', // national highway\n  'secondary'     : '#ffffff', // sub road\n  'tertiary'      : '#ffffff', // sub road\n  'residental'    : '#ffffff', // minor road\n  'living_street' : '#ffffff', // minor road\n  'track'         : '#ffffff', // ?\n  'trunk'         : '#ffffff', // ?\n  'footway'       : '#ffffff', // footway\n  'pedestrian'    : '#f0ebeb', // pedestrian\n};\nconst KIND_COLOR_MAP = {\n  'major_road': '#f7c616',\n  'minor_road': '#ffffff',\n  'highway'   : '#888785',\n  'path'      : '#888785',\n  'rail'      : '#888785',\n};\nconst HIGHWAY_WIDTH_MAP = {\n  'motorway'      : 10, // express way\n  'major'         : 10, // main road\n  'primary'       : 10, // national highway\n  'secondary'     : 7,  // sub road\n  'tertiary'      : 6,  // sub road\n  'residental'    : 5,  // minor road\n  'living_street' : 4,  // minor road\n  'track'         : 3,  // ?\n  'trunk'         : 3,  // ?\n  'footway'       : 1,  // footway\n  'pedestrian'    : 1,  // pedestrian\n};\n// jscs:enable disallowSpaceAfterObjectKeys\n// ---\n\nvar HighwayUtils = (function() {\n\n  /**\n   * Return the style for a specific highway\n   *\n   * @param {Object} feature\n   */\n  var style = function(feature, defaultValue) {\n    var color;\n\n    // ---- color\n    // based on 'highway' property\n    if (feature.properties.highway) {\n      if (feature.properties.highway in HIGHWAY_COLOR_MAP) {\n        color = HIGHWAY_COLOR_MAP[feature.properties.highway];\n      } else {\n        // unknown highway\n        console.info('Unknown highway: ' + feature.properties.highway);\n      }\n    }\n    // based on 'kind' property\n    else if (feature.properties.kind) {\n      if (feature.properties.kind in KIND_COLOR_MAP) {\n        color = KIND_COLOR_MAP[feature.properties.kind];\n      } else {\n        // unknown highway kind\n        console.info('Unknown highway kind: ' + feature.properties.kind);\n      }\n    }\n    // ---\n\n    // construct the style\n    var style = {\n      color: color || defaultValue.color\n    };\n\n    return extend({}, defaultValue, style);\n  };\n\n  /**\n   * Return the line width for a specific highway\n   *\n   * @param {Object} feature\n   */\n  var lineWidth = function(feature, defaultValue) {\n    var lineWidth;\n    // look for the line weight in the property\n    if (feature.properties.width) {\n      lineWidth = feature.properties.width;\n    }\n    // guess lineWidth from the highway type\n    else if (feature.properties.highway) {\n      if (feature.properties.highway in HIGHWAY_WIDTH_MAP) {\n        lineWidth = HIGHWAY_WIDTH_MAP[feature.properties.highway];\n      } else {\n        // unknown highway type\n        console.info('Unknown highway: ' + feature.properties.highway);\n        lineWidth = defaultValue;\n      }\n    }\n    // no way to find out the width\n    else {\n      // no highway type mentioned\n      lineWidth = defaultValue;\n    }\n    return lineWidth;\n  };\n\n  /**\n   * Convert LineString to Polygon\n   *\n   * @param {Object} world VIZI.World object\n   * @param {Array} coords LineString, e.g. [[lon, lat], [lon, lat], ...]\n   * @param {Number} lineWidth the width of the lines\n   */\n  var lineStringToPolygon = function(world, coords, lineWidth) {\n    return multiLineStringToPolygon(world, [coords], lineWidth);\n  };\n\n  /**\n   * Convert MultiLineString to Polygon\n   *\n   * @param {Object} world VIZI.World object\n   * @param {Array} coordss Array of LineStrings, e.g. [[[lon, lat], [lon, lat], ...], ...]\n   * @param {Number} lineWidth the width of the lines\n   * @returns {Array}\n   */\n  var multiLineStringToPolygon = function(world, coordss, lineWidth) {\n    if (lineWidth === undefined) {\n      lineWidth = 1.0;\n    }\n\n    // jscs:disable disallowMultipleVarDecl\n    var cLatLon, pLatLon, nLatLon;\n    var cGeoCoord, pGeoCoord, nGeoCoord;\n    var vVert = new VIZI.Point(), _vVert   = new VIZI.Point();\n    var vMean = new VIZI.Point(), vPadding = new VIZI.Point(), _vPadding = new VIZI.Point();\n    var p = new VIZI.Point(), _p;\n    // jscs:enable disallowMultipleVarDecl\n\n    var outCoordss = [];\n\n    coordss.forEach(function(coords) {\n      var outCoords = [];\n\n      cLatLon = pLatLon = nLatLon = null;\n      cGeoCoord = pGeoCoord = nGeoCoord = null;\n\n      for (var i = 0; i < coords.length; i++) {\n        cLatLon   = nLatLon   || new VIZI.LatLon(coords[i][1], coords[i][0]);\n        cGeoCoord = nGeoCoord || world.latLonToPoint(cLatLon);\n\n        // project the next coordinate\n        if (i < coords.length - 1) {\n          nLatLon = new VIZI.LatLon(coords[i + 1][1], coords[i + 1][0]);\n          nGeoCoord = world.latLonToPoint(nLatLon);\n\n          // calculate the vertical vector\n          vVert.x = -(nGeoCoord.y - cGeoCoord.y);\n          vVert.y =  (nGeoCoord.x - cGeoCoord.x);\n          normalize(vVert);\n\n          // incorpolate the vertical vector with the previous one\n          if (i == 0) {\n            _vVert.x = vVert.x; _vVert.y = vVert.y;\n          }\n          vMean.x = (vVert.x + _vVert.x) / 2.0; vMean.y = (vVert.y + _vVert.y) / 2.0;\n          normalize(vMean);\n          vPadding.x =  vMean.x * lineWidth; vPadding.y =  vMean.y * lineWidth;\n        } else {\n          vPadding.x = _vVert.x * lineWidth; vPadding.y = _vVert.y * lineWidth;\n        }\n\n        // construct polygons\n        if (0 < i) {\n          if (i == 1) {\n            // left top\n            p.x = pGeoCoord.x - _vPadding.x; p.y = pGeoCoord.y - _vPadding.y;\n            _p = world.pointToLatLon(p);\n            outCoords.splice(0, 0, [_p.lon, _p.lat]);\n\n            // left bottom\n            p.x = pGeoCoord.x + _vPadding.x; p.y = pGeoCoord.y + _vPadding.y;\n            _p = world.pointToLatLon(p);\n            outCoords.splice(0, 0, [_p.lon, _p.lat]);\n          }\n\n          var idx = outCoords.length / 2;\n          // right bottom\n          p.x = cGeoCoord.x + vPadding.x; p.y = cGeoCoord.y + vPadding.y;\n          _p = world.pointToLatLon(p);\n          outCoords.splice(idx, 0, [_p.lon, _p.lat]);\n\n          // right top\n          p.x = cGeoCoord.x - vPadding.x; p.y = cGeoCoord.y - vPadding.y;\n          _p = world.pointToLatLon(p);\n          outCoords.splice(idx + 1, 0, [_p.lon, _p.lat]);\n        }\n\n        // keep the vectors as the previous one\n        pLatLon = cLatLon;\n        pGeoCoord = cGeoCoord;\n        _vVert.x = vVert.x; _vVert.y = vVert.y;\n        _vPadding.x = vPadding.x; _vPadding.y = vPadding.y;\n      }\n\n      // add the first vertice at the end to make the polygon closed\n      outCoords.push(outCoords[0]);\n\n      // add this polygon to the array of polygons\n      outCoordss.push([outCoords]);\n    });\n\n    return outCoordss;\n  };\n\n  // --- internal helper methods\n  /** Normalize VIZI.Point */\n  function normalize(p) {\n    var l = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    l = (l === 0.0) ? 1.0 : l;\n    p.x /= l;\n    p.y /= l;\n  }\n  // ---\n\n  // return the utility object\n  return {\n    style: style,\n    lineWidth: lineWidth,\n    lineStringToPolygon: lineStringToPolygon,\n    multiLineStringToPolygon: multiLineStringToPolygon\n  };\n})();\n\nexport default HighwayUtils;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/HighwayUtils.js\n **/","/**\n * Worker Utils\n */\n\nvar WorkerUtils = (function() {\n\n  /** base directory */\n  var base = (function() {\n    var current = (function() {\n      if (document.currentScript) {\n        return document.currentScript.src;\n      } else {\n        var scripts = document.getElementsByTagName('script');\n        var script = scripts[scripts.length - 1];\n        if (script.src) {\n          return script.src;\n        }\n      }\n    })();\n    if (current) {\n      return dirname(current);\n    }\n  })();\n\n  /** Definition: Worker dependencies */\n  var dependencies = [\n    base + '/simultra-worker.js'\n  ];\n\n  /**\n   * Returns worker dependencies\n   *\n   * @returns {string[]}\n   */\n  var getDependencies = function() {\n    return dependencies;\n  };\n\n  // --- internal helper methods\n  function basename(path) {\n    return path.replace(/\\\\/g, '/').replace(/.*\\//, '');\n  }\n  function dirname(path) {\n    return path.replace(/\\\\/g, '/').replace(/\\/[^\\/]*$/, '');;\n  }\n  // ---\n\n  // return the utility object\n  return {\n    getDependencies: getDependencies\n  };\n})();\n\nexport default WorkerUtils;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/util/WorkerUtils.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\n\nimport BuildingUtils from '../util/BuildingUtils';\n\nclass BuildingLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {\n\n    };\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._setup();\n  }\n\n  _setup() {\n\n    // Buildings from Mapzen\n    // var viziLayer = VIZI.topoJSONTileLayer('https://vector.mapzen.com/osm/buildings/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n    var viziLayer = VIZI.topoJSONTileLayer('https://tile.mapzen.com/mapzen/vector/v1/buildings/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n      interactive: false,\n      maxLOD: 14,\n      style: function(feature) {\n        return BuildingUtils.style(feature, {\n          height: 1,\n          lineColor: '#f7c616',\n          lineWidth: 1,\n          lineTransparent: true,\n          lineOpacity: 0.2,\n          lineBlending: THREE.AdditiveBlending,\n          lineRenderOrder: 2\n        });\n      },\n      filter: function(feature) {\n        // Don't show points\n        return feature.geometry.type !== 'Point';\n      },\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, <a href=\"http://whosonfirst.mapzen.com#License\">Who\\'s On First</a>.'\n    });\n\n    // set the instance properties\n    this._setViziLayer(viziLayer);\n\n  }\n}\n\nexport default BuildingLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/BuildingLayer.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\nimport FootwayUtils from '../util/FootwayUtils';\n\nclass FootwayLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {\n\n    };\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._setup();\n  }\n\n  _setup() {\n\n    var self = this;\n\n    // Landuses from Mapzen\n    // var viziLayer = VIZI.topoJSONTileLayer('https://vector.mapzen.com/osm/landuse,roads/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n    var viziLayer = VIZI.topoJSONTileLayer('https://tile.mapzen.com/mapzen/vector/v1/landuse,roads/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n      interactive: false,\n      maxLOD: 18,\n      style: function(feature) {\n        if (feature.properties.lanes) {\n          console.log(feature);\n        }\n        if (feature.properties.width) {\n          console.log(feature);\n        }\n\n        return FootwayUtils.style(feature, {\n          height: 0.5\n        });\n      },\n      filter: function(feature) {\n        // Don't show points\n        if (feature.geometry.type === 'Point') {\n          return false;\n        }\n\n        // pedestrian (Polygon)\n        if (feature.properties.kind === 'pedestrian') {\n          return true;\n        }\n\n        // footway (LineString)\n        if (feature.properties.highway === 'footway') {\n          return true;\n        }\n\n        return false;\n      },\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, <a href=\"http://whosonfirst.mapzen.com#License\">Who\\'s On First</a>.'\n    });\n\n    // set the instance properties\n    this._setViziLayer(viziLayer);\n\n  }\n}\n\nexport default FootwayLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/FootwayLayer.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\n\nimport HighwayUtils from '../util/HighwayUtils';\n\nclass HighwayLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {};\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._setup();\n  }\n\n  _setup() {\n\n    var self = this;\n\n    // Roads from Mapzen\n    // var viziLayer = VIZI.topoJSONTileLayer('https://vector.mapzen.com/osm/roads/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n    var viziLayer = VIZI.topoJSONTileLayer('https://tile.mapzen.com/mapzen/vector/v1/roads/{z}/{x}/{y}.topojson?api_key=mapzen-2PvEx4B', {\n      interactive: false,\n      maxLOD: 18,\n      style: function(feature) {\n        if (feature.properties.lanes) {\n          console.log(feature);\n        }\n        if (feature.properties.width) {\n          console.log(feature);\n        }\n\n        return HighwayUtils.style(feature, {\n          height: 0,\n          opacity: 0.2\n        });\n      },\n      filter: function(feature) {\n        // Don't show points\n        if (feature.geometry.type === 'Point') {\n          return false;\n        }\n\n        // Convert LineString to polygon\n        if (feature.geometry.type === 'LineString') {\n          var lineWidth = HighwayUtils.lineWidth(feature, 1.0);\n          var outCoordss = HighwayUtils.lineStringToPolygon(self._getViziWorld(), feature.geometry.coordinates, lineWidth);\n\n          feature.geometry.type = 'MultiPolygon';\n          feature.geometry.coordinates = outCoordss;\n        }\n        // Convert MultiLineString to Polygon\n        else if (feature.geometry.type === 'MultiLineString') {\n          var lineWidth = HighwayUtils.lineWidth(feature, 1.0);\n          var outCoordss = HighwayUtils.multiLineStringToPolygon(self._getViziWorld(), feature.geometry.coordinates, lineWidth);\n\n          feature.geometry.type = 'MultiPolygon';\n          feature.geometry.coordinates = outCoordss;\n        }\n\n        return true;\n      },\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, <a href=\"http://whosonfirst.mapzen.com#License\">Who\\'s On First</a>.'\n    });\n\n    // set the instance properties\n    this._setViziLayer(viziLayer);\n\n  }\n}\n\nexport default HighwayLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/HighwayLayer.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\n\nimport Layer from './Layer';\n\nimport API from '../io/API';\n\nimport WorkerUtils from '../util/WorkerUtils';\n\nconst UPDATE_INTERVAL_MS = 1000;\n\nclass PedestrianLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {\n      renderer: 'cpu'\n    };\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._pedestrians = [];\n\n    this._setup();\n  }\n\n  _setup() {\n\n    // pedestrian layer\n    var viziLayer = VIZI.pedestrianLayer({\n      'monkey': {\n        file: {\n          body: '/javascripts/maps/json/monkey/monkey.json',\n        },\n        scale: 1.0,\n        translation: {x: 0, y: 0, z: 0},\n        rotation: {x: 0, y: 0, z: 0}\n      }\n    }, {\n      enableGpuComputation: this._options.renderer === 'gpu',\n      simWidth: 32,\n      style: {\n        height: 0\n      }\n    });\n\n    // set the instance property\n    this._setViziLayer(viziLayer);\n\n  }\n\n  _onAdd(simultra) {\n    super._onAdd(simultra);\n\n    // create the worker thread for websocket\n    this._worker = operative(this._createWorker(), WorkerUtils.getDependencies());\n  }\n\n  _onRemove() {\n    super._onRemove();\n\n    // destroy the worker\n    this._worker = null;\n  }\n\n  /**\n   * Starts updating the view\n   */\n  start() {\n    this._isRunning = true;\n\n    var self = this;\n\n    // start all of the workers\n    this._worker.start(this._createWorkerCallback());\n\n    // start pedestrian manager\n    var ws = this._api.wsPedestrians();\n    ws.onclose = function(event) {\n      console.log('closed pedestrian manager');\n    };\n    ws.onmessage = function(event) {\n      self._onMessage(event.data);\n    };\n    ws.onopen = function() {\n      console.log('opened pedestrian manager');\n    };\n    this._ws = ws;\n\n    setTimeout(function() { self._update(); }, 0);\n  }\n\n  /**\n   * Stops updating the view\n   */\n  stop() {\n    this._isRunning = false;\n\n    // terminate pedestrian manager\n    if (this._ws) {\n      this._ws.close();\n    }\n\n    // terminate all of the workers\n    this._worker.stop();\n  }\n\n  _onMessage(data) {\n    var self = this;\n    if (data === 'creation') {\n      setTimeout(function() { self._update(); }, 0);\n    } else if (data === 'deletion') {\n      setTimeout(function() { self._update(); }, 0);\n    } else {\n      console.error('unknown message ' + data);\n    }\n  }\n\n  // (rest)\n  // _update() {\n  //   var self = this;\n  //\n  //   if (this._isRunning) {\n  //\n  //     this._lastUpdatedAt = Date.now();\n  //\n  //     this._api.getPedestrians()\n  //       .then(function(data) {\n  //\n  //         self._performUpdate(data);\n  //\n  //       }).catch(function(err) {\n  //\n  //       console.error('Error updating the pedestrian layer:' + err);\n  //\n  //     }).then(function() {\n  //\n  //       if (self._isRunning) {\n  //         // calculate the delay\n  //         var lastUpdate = self._lastUpdatedAt;\n  //         var now = Date.now();\n  //         var delay = UPDATE_INTERVAL_MS - (now - lastUpdate);\n  //\n  //         // register the next update\n  //         setTimeout(function() { self._update(); }, (delay > 0) ? delay : 0);\n  //       }\n  //\n  //     });\n  //\n  //   }\n  // }\n\n  // (websocket)\n  _update() {\n    var self = this;\n\n    if (this._isRunning) {\n\n      this._lastUpdatedAt = Date.now();\n\n      this._api.getPedestrians()\n        .then(function(data) {\n\n          self._performUpdate(data);\n\n        }).catch(function(err) {\n\n        console.error('Error updating the pedestrian layer:' + err);\n\n      });\n    }\n  }\n\n  _performUpdate(data) {\n    var self = this;\n    var viziLayer = this._getViziLayer();\n\n    // map pedestrian parameters into dictionaries\n    data.forEach(pedestrian => {\n      // if pedestrian does not exist\n      if (!self._hasPedestrian(pedestrian)) {\n        // add to pedestrian layer\n        self._addPedestrian(pedestrian);\n      }\n    });\n\n  }\n\n  _hasPedestrian(pedestrian) {\n    return (pedestrian.id in this._pedestrians);\n  }\n\n  _addPedestrian(pedestrian) {\n    var viziLayer = this._getViziLayer();\n\n    // add pedestrian to the vizi layer\n    var object = viziLayer.addPedestrian(\n      pedestrian.type,\n      new VIZI.LatLon(pedestrian.location.lat, pedestrian.location.lon),\n      pedestrian.angle\n    );\n\n    // add entry to dictionary\n    var entry = {\n      data: pedestrian,\n      object: object\n    };\n    this._pedestrians[pedestrian.id] = entry;\n\n    console.log('added pedestrian: ' + JSON.stringify(pedestrian));\n    this.emit('onAddPedestrian', pedestrian.id, entry);\n    return entry;\n  }\n\n  // (websocket)\n  _createWorker() {\n    var baseUrl = this._api.baseUrl;\n    return {\n      _baseUrl: baseUrl,\n      _api: null,\n      _callback: null,\n      _isRunning: false,\n\n      /** start updating the pedestrian */\n      start: function(callback) {\n        this._api = new SimWorker.API(this._baseUrl);\n        this._callback = callback;\n        this._isRunning = true;\n\n        var self = this;\n        setTimeout(function() { self._update(); }, self._interval);\n      },\n\n      _update: function() {\n        var self = this;\n\n        var socket = this._api.wsAllPedestrians();\n        socket.onclose = function(event) {\n          self._isRunning = false;\n          console.log('closed pedestrian websocket');\n        };\n        socket.onmessage = function(event) {\n          // here, \"event\" is an instance of MessageEvent, which cannot be serialized to send to the UI thread,\n          // hence, we just extract the data object (sent by another peer) and transfer it to the UI thread.\n          // console.log(event.data);\n          if (event.data) {\n            self._callback(JSON.parse(event.data));\n          }\n        };\n        socket.onopen = function() {\n          console.log('opened pedestrian websocket');\n        };\n      },\n\n      /** stop updating */\n      stop: function() {\n        this._isRunning = false;\n      }\n    };\n  }\n\n  _createWorkerCallback() {\n    return (function(that) {\n      var scopes = {};\n      var defaultScope = {\n        prevSender: ''\n      };\n\n      return function(msg) {\n        var sender = msg.sender;\n        var pedestrian = msg.data;\n\n        // retrieve local scope for this pedestrian\n        var scope = (pedestrian.id in scopes) ? scopes[pedestrian.id] : (scopes[pedestrian.id] = extend({}, defaultScope));\n\n        // update the object in simultra\n        if (pedestrian.id in that._pedestrians) {\n          var entry = that._pedestrians[pedestrian.id];\n          entry.data = pedestrian;\n\n          var viziLayer = that._getViziLayer();\n\n          // update the object in vizi layer\n          if (scope.prevSender !== sender) {\n            viziLayer.setLabelClass(pedestrian.id, 'label pedestrian');\n            viziLayer.setLabelText(pedestrian.id, sender);\n          }\n          viziLayer.setLocation(pedestrian.id, pedestrian.location.lat, pedestrian.location.lon, -pedestrian.angle);\n          viziLayer.setVelocity(pedestrian.id, pedestrian.velocity, 0, 0, 0);\n\n          // emit\n          that.emit('onUpdatePedestrian', pedestrian.id, entry, sender);\n        }\n      };\n    })(this);\n  }\n\n  /**\n   * Sets the Simultra to focus on the specific vehicle\n   *\n   * @param id\n   */\n  focusOn(id) {\n    if (id in this._pedestrians) {\n      this._getSimultra().focusOn((function(self, id) {\n        return {\n          point: function() {\n            var position = self._pedestrians[id].object.pedestrian.root.position;\n            return new VIZI.Point(position.x, position.z);\n          }\n        };\n      })(this, id));\n    } else {\n      this._getSimultra().focusOn(null);\n    }\n  }\n\n}\n\nexport default PedestrianLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/PedestrianLayer.js\n **/","/**\n * API Helper\n */\nimport WebClient from './WebClient';\n\n// --- API endpoint definitions\nconst START_SIMULATION = '/api/v1/start';\nconst IS_RUNNING = '/api/v1/isRunning';\nconst STOP_SIMULATION = '/api/v1/stop';\n\nconst GET_VEHICLES = '/api/v1/vehicles';\nconst UPDATE_VEHICLES = '/api/v1/vehicles';\nconst GET_VEHICLE = function(vid) { return '/api/v1/vehicles/' + vid; };\nconst WS_VEHICLES = '/api/v1/vehicles-ws';\nconst WS_VEHICLE = function(vid) { return '/api/v1/vehicles/' + vid + '/ws'; };\n\nconst GET_PEDESTRIANS = '/api/v1/pedestrians';\nconst UPDATE_PEDESTRIANS = '/api/v1/pedestrians';\nconst GET_PEDESTRIAN = function(pid) { return '/api/v1/pedestrians/' + pid; };\nconst WS_PEDESTRIANS = '/api/v1/pedestrians-ws';\nconst WS_PEDESTRIAN = function(pid) { return '/api/v1/pedestrians/' + pid + '/ws'; };\n// ---\n\nclass API extends WebClient {\n  constructor(baseUrl) {\n    super();\n    this.baseUrl = baseUrl;\n    this.wsBaseUrl = baseUrl.replace(/^https?:\\/\\//, 'ws://');\n  }\n\n  // --- Controller\n  startSimulation(map, type, scenario) {\n    return this._ajax({\n      url: this.baseUrl + START_SIMULATION,\n      method: 'post',\n      data: JSON.stringify({\n        map: map,\n        type: type,\n        scenario: scenario\n      })\n    });\n  }\n\n  isRunning() {\n    return this._ajax({\n      url: this.baseUrl + IS_RUNNING,\n      method: 'get'\n    });\n  }\n\n  stopSimulation() {\n    return this._ajax({\n      url: this.baseUrl + STOP_SIMULATION,\n      method: 'post'\n    });\n  }\n\n  // --- Vehicles\n  getVehicles() {\n    return this._ajax({\n      url: this.baseUrl + GET_VEHICLES,\n      method: 'get'\n    });\n  }\n\n  updateVehicles(data) {\n    return this._ajax({\n      url: this.baseUrl + UPDATE_VEHICLES,\n      method: 'put',\n      data: data\n    });\n  }\n\n  getVehicle(vid) {\n    return this._ajax({\n      url: this.baseUrl + GET_VEHICLE(vid),\n      method: 'get'\n    });\n  }\n\n  wsVehicles() {\n    return new WebSocket(this.wsBaseUrl + WS_VEHICLES);\n  }\n\n  wsVehicle(vid) {\n    return new WebSocket(this.wsBaseUrl + WS_VEHICLE(vid));\n  }\n\n  wsAllVehicles() {\n    return this.wsVehicle('all');\n  }\n  // ---\n\n  // --- Pedestrians\n  getPedestrians() {\n    return this._ajax({\n      url: this.baseUrl + GET_PEDESTRIANS,\n      method: 'get'\n    });\n  }\n\n  updatePedestrians(data) {\n    return this._ajax({\n      url: this.baseUrl + UPDATE_PEDESTRIANS,\n      method: 'put',\n      data: data\n    });\n  }\n\n  getPedestrian(pid) {\n    return this._ajax({\n      url: this.baseUrl + GET_PEDESTRIAN(pid),\n      method: 'get'\n    });\n  }\n\n  wsPedestrians() {\n    return new WebSocket(this.wsBaseUrl + WS_PEDESTRIANS);\n  }\n\n  wsPedestrian(pid) {\n    return new WebSocket(this.wsBaseUrl + WS_PEDESTRIAN(pid));\n  }\n\n  wsAllPedestrians() {\n    return this.wsPedestrian('all');\n  }\n  // ---\n\n}\n\nexport default API;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/io/API.js\n **/","/**\n * Created by masayuki on 28/07/2016.\n */\nimport extend from 'extend';\n\nclass WebClient {\n  constructor() {\n\n  }\n\n  _ajax(param) {\n    var defaultParam = {\n      url: null,\n      method: 'GET',\n      data: null,\n      type: 'json'\n    };\n    param = extend({}, defaultParam, param);\n\n    return new Promise(function(resolve, reject) {\n      var method = param.method.toUpperCase();\n\n      var xhr = new XMLHttpRequest();\n      xhr.open(method, param.url);\n      xhr.responseType = param.type;\n\n      // set callbacks\n      xhr.onload = function() {\n        if (xhr.status === 200) {\n          resolve(xhr.response);\n        } else {\n          reject(Error(xhr.statusText));\n        }\n      };\n      xhr.onerror = function() {\n        reject(Error('Network Error'));\n      };\n\n      // send data if exists\n      if ((method === 'POST' || method === 'PUT') && param.data) {\n        xhr.send(param.data);\n      }\n      // or send the request without data\n      else {\n        xhr.send();\n      }\n    });\n  }\n\n}\n\nexport default WebClient;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/io/WebClient.js\n **/","import VIZI from 'vizi';\nimport extend from 'extend';\nimport operative from 'operative';\n\nimport Layer from './Layer';\n\nimport API from '../io/API';\n\nimport WorkerUtils from '../util/WorkerUtils';\n\nconst UPDATE_INTERVAL_MS = 10000;\n\nclass VehicleLayer extends Layer {\n  constructor(options) {\n    var defaultOptions = {\n      renderer: 'cpu'\n    };\n\n    var _options = extend({}, defaultOptions, options);\n    super(_options);\n\n    this._vehicles = [];\n\n    this._setup();\n  }\n\n  _setup() {\n\n    // car layer\n    var viziLayer = VIZI.vehicleLayer({\n      'veyron': {\n        file: {\n          body: '/javascripts/maps/objs/veyron/parts/veyron_body_bin.js',\n          wheel: '/javascripts/maps/objs/veyron/parts/veyron_wheel_bin.js'\n        },\n        textureFile: '/javascripts/maps/objs/veyron/texture.png',\n        scale: 0.025,\n        translation: {x: 0, y: 0, z: 0},\n        rotation: {x: 0, y: 90 * Math.PI / 180, z: 0}\n      }\n    }, {\n      enableGpuComputation: this._options.renderer === 'gpu',\n      simWidth: 32,\n      style: {\n        height: 0\n      }\n    });\n\n    // set the instance property\n    this._setViziLayer(viziLayer);\n\n  }\n\n  _onAdd(simultra) {\n    super._onAdd(simultra);\n\n    // create the worker thread for websocket\n    this._worker = operative(this._createWorker(), WorkerUtils.getDependencies());\n  }\n\n  _onRemove() {\n    super._onRemove();\n\n    // destroy the worker\n    this._worker = null;\n  }\n\n  /**\n   * Starts updating the view\n   */\n  start() {\n    this._isRunning = true;\n\n    var self = this;\n\n    // start the worker\n    this._worker.start(this._createWorkerCallback());\n\n    // start vehicle manager\n    var ws = this._api.wsVehicles();\n    ws.onclose = function(event) {\n      console.log('closed vehicle manager');\n    };\n    ws.onmessage = function(event) {\n      self._onMessage(event.data);\n    };\n    ws.onopen = function() {\n      console.log('opened vehicle manager');\n    };\n    this._ws = ws;\n\n    setTimeout(function() { self._update(); }, 0);\n  }\n\n  /**\n   * Stops updating the view\n   */\n  stop() {\n    this._isRunning = false;\n\n    // terminate vehicle manager\n    if (this._ws) {\n      this._ws.close();\n    }\n\n    // terminate all of the workers\n    this._worker.stop();\n  }\n\n  _onMessage(data) {\n    var self = this;\n    if (data === 'creation') {\n      setTimeout(function() { self._update(); }, 0);\n    } else if (data === 'deletion') {\n      setTimeout(function() { self._update(); }, 0);\n    } else {\n      console.error('unknown message ' + data);\n    }\n  }\n\n  // (rest)\n  // _update() {\n  //   var self = this;\n  //\n  //   if (this._isRunning) {\n  //\n  //     this._lastUpdatedAt = Date.now();\n  //\n  //     this._api.getVehicles()\n  //       .then(function(data) {\n  //\n  //         self._performUpdate(data);\n  //\n  //       }).catch(function(err) {\n  //\n  //       console.error('Error updating the vehicle layer: ' + err);\n  //\n  //     }).then(function() {\n  //\n  //       if (self._isRunning) {\n  //         // calculate the delay\n  //         var lastUpdate = self._lastUpdatedAt;\n  //         var now = Date.now();\n  //         var delay = UPDATE_INTERVAL_MS - (now - lastUpdate);\n  //\n  //         // register the next update\n  //         setTimeout(function() { self._update(); }, (delay > 0) ? delay : 0);\n  //       }\n  //\n  //     });\n  //\n  //   }\n  // }\n\n  // (websocket)\n  _update() {\n    var self = this;\n\n    if (this._isRunning) {\n\n      this._lastUpdatedAt = Date.now();\n\n      this._api.getVehicles()\n        .then(function(data) {\n\n          self._performUpdate(data);\n\n        }).catch(function(err) {\n\n          console.error('Error updating the vehicle layer: ' + err);\n\n        });\n\n    }\n  }\n\n  _performUpdate(data) {\n    var self = this;\n\n    // map vehicle parameters into dictionaries\n    data.forEach(vehicle => {\n      // if vehicle does not exist\n      if (!self._hasVehicle(vehicle)) {\n        // add to vehicle layer\n        self._addVehicle(vehicle);\n      }\n    });\n  }\n\n  _hasVehicle(vehicle) {\n    return (vehicle.id in this._vehicles);\n  }\n\n  _addVehicle(vehicle) {\n    var viziLayer = this._getViziLayer();\n\n    // add vehicle to the vizi layer\n    var object = viziLayer.addVehicle(\n      vehicle.type,\n      new VIZI.LatLon(vehicle.location.lat, vehicle.location.lon),\n      vehicle.angle\n    );\n\n    // add entry to dictionary\n    var entry = {\n      data: vehicle,\n      object: object\n    };\n    this._vehicles[vehicle.id] = entry;\n    // this._vehicles.push(entry);\n\n    console.log('added vehicle: ' + JSON.stringify(vehicle));\n    this.emit('onAddVehicle', vehicle.id, entry);\n    return entry;\n  }\n\n  // (rest)\n  // _createWorker() {\n  //   var baseUrl = this._api.baseUrl;\n  //   return {\n  //     _interval: 10,\n  //     _baseUrl: baseUrl,\n  //     _api: null,\n  //     _id: null,\n  //     _callback: null,\n  //     _isRunning: false,\n  //\n  //     /** start updating the vehicle */\n  //     start: function(id, callback) {\n  //       this._api = new SimWorker.API(this._baseUrl);\n  //       this._id = id;\n  //       this._callback = callback;\n  //       this._isRunning = true;\n  //\n  //       var self = this;\n  //       setTimeout(function() { self._update(); }, self._interval);\n  //     },\n  //\n  //     _update: function() {\n  //       var id = this._id;\n  //       var self = this;\n  //       this._api.getVehicle(id)\n  //         .then(function(data) {\n  //           self._callback(data);\n  //         })\n  //         .catch(function(err) {\n  //           console.error(err);\n  //         })\n  //         .then(function() {\n  //           if (self._isRunning) {\n  //             setTimeout(function() { self._update(); }, self._interval);\n  //           }\n  //         });\n  //     },\n  //\n  //     /** stop updating */\n  //     stop: function() {\n  //       this._isRunning = false;\n  //     }\n  //   };\n  // }\n\n  // (websocket)\n  _createWorker() {\n    var baseUrl = this._api.baseUrl;\n    return {\n      _baseUrl: baseUrl,\n      _api: null,\n      _socket: null,\n      _callback: null,\n      _isRunning: false,\n\n      /** start updating the vehicle */\n      start: function(callback) {\n        this._api = new SimWorker.API(this._baseUrl);\n        this._callback = callback;\n        this._isRunning = true;\n\n        var self = this;\n        setTimeout(function() { self._update(); }, 0);\n      },\n\n      _update: function() {\n        var self = this;\n\n        var socket = this._api.wsAllVehicles();\n        socket.onclose = function(event) {\n          self._isRunning = false;\n          console.log('closed vehicle websocket');\n        };\n        socket.onmessage = function(event) {\n          // here, \"event\" is an instance of MessageEvent, which cannot be serialized to send to the UI thread,\n          // hence, we just extract the data object (sent by another peer) and transfer it to the UI thread.\n          // console.log(event.data);\n          if (event.data) {\n            self._callback(JSON.parse(event.data));\n          }\n        };\n        socket.onopen = function() {\n          console.log('opened vehicle websocket');\n        };\n        self._socket = socket;\n      },\n\n      /** stop updating */\n      stop: function() {\n        this._isRunning = false;\n      }\n    };\n  }\n\n  _createWorkerCallback() {\n    return (function(that) {\n      var scopes = {};\n      var defaultScope = {\n        prevSender: ''\n      };\n\n      return function(msg) {\n        var sender = msg.sender;\n        var vehicle = msg.data;\n\n        // retrieve local scope for this vehicle\n        var scope = (vehicle.id in scopes) ? scopes[vehicle.id] : (scopes[vehicle.id] = extend({}, defaultScope));\n\n        // update the object in simultra\n        if (vehicle.id in that._vehicles) {\n          var entry = that._vehicles[vehicle.id];\n          entry.data = vehicle;\n\n          var viziLayer = that._getViziLayer();\n\n          // update the object in vizi layer\n          if (scope.prevSender !== sender) {\n            viziLayer.setLabelClass(vehicle.id, 'label vehicle');\n            viziLayer.setLabelText(vehicle.id, sender);\n            scope.prevSender = sender;\n          }\n          viziLayer.setLocation(vehicle.id, vehicle.location.lat, vehicle.location.lon, -vehicle.angle);\n          viziLayer.setVelocity(vehicle.id, vehicle.velocity, 0, 0, vehicle.wheel);\n\n          // emit\n          that.emit('onUpdateVehicle', vehicle.id, entry, sender);\n        }\n      };\n    })(this);\n  }\n\n  /**\n   * Returns the centroid of vehicles\n   */\n  getCentroid() {\n    if (this._vehicles.length > 0) {\n      // FIXME: calculate the centroid of all vehicles\n      // var location = this._vehicles[0].object.latlon;\n      if (this._vehicles[0].object.vehicle && this._vehicles[0].object.vehicle.root) {\n        var position = this._vehicles[0].object.vehicle.root.position;\n        var point = new VIZI.Point(position.x, position.z);\n        var latLon = this._getViziWorld().pointToLatLon(point);\n        return latLon; // {lat: 35.xxx, lon: 140.xxx}\n      } else {\n        return null;\n      }\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Sets the Simultra to focus on the specific vehicle\n   *\n   * @param id\n   */\n  focusOn(id) {\n    if (id in this._vehicles) {\n      this._getSimultra().focusOn((function(self, id) {\n        return {\n          point: function() {\n            var position = self._vehicles[id].object.vehicle.root.position;\n            return new VIZI.Point(position.x, position.z);\n          }\n        };\n      })(this, id));\n    } else {\n      this._getSimultra().focusOn(null);\n    }\n  }\n\n}\n\nexport default VehicleLayer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/layer/VehicleLayer.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_21__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"operative\"\n ** module id = 21\n ** module chunks = 0\n **/"],"sourceRoot":""}